<html>
<head>
  <title>Generate Token</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"></link>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-analytics.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBggKVSzDyI-meBSL3BMjA736Ss-j_My0E",
      authDomain: "gmi-enterprise23.firebaseapp.com",
      projectId: "gmi-enterprise23",
      storageBucket: "gmi-enterprise23.firebasestorage.app",
      messagingSenderId: "974090028804",
      appId: "1:974090028804:web:43ae563ffd9433463c7251",
      measurementId: "G-S27YB5Z8PR"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);

    function generateToken(length = 16) {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      let result = '';
      for (let i = 0; i < length; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return result;
    }

    async function createToken() {
      const token = generateToken(16);
      const durationMs = 136060 * 1000; // 13 hours in milliseconds

      try {
        await addDoc(collection(db, "token"), {
          token: token,
          createdAt: serverTimestamp(),
          duration: durationMs
        });
        document.getElementById('tokenDisplay').textContent = token;
      } catch (e) {
        document.getElementById('tokenDisplay').textContent = "Error generating token.";
        console.error("Error adding document: ", e);
      }
    }

    window.addEventListener('DOMContentLoaded', () => {
      createToken();
      document.getElementById('generateBtn').addEventListener('click', createToken);
    });
  </script>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col items-center justify-center p-4">
  <div class="max-w-md w-full bg-white rounded-lg shadow-md p-6 text-center">
    <h1 class="text-2xl font-bold mb-4 text-gray-800">Generate Token</h1>
    <p class="mb-6 text-gray-600">Token will be generated automatically when the page loads or when you press the button below.</p>
    <div class="mb-6">
      <div class="inline-block px-6 py-3 bg-indigo-100 text-indigo-700 font-mono text-xl rounded select-all" id="tokenDisplay" aria-live="polite" aria-label="Generated token">Loading...</div>
    </div>
    <button id="generateBtn" class="inline-flex items-center gap-2 px-5 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded shadow focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1 transition">
      <i class="fas fa-sync-alt"></i> Generate New Token
    </button>
  </div>
</body>
</html>
