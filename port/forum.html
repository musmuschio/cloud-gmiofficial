<!-- FILE: login.html -->
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Login - GMI Forum</title>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD6Xx37x_IOCh67eoq3CdVNwEchvfiCgBA",
      authDomain: "training-gmiproject.firebaseapp.com",
      projectId: "training-gmiproject",
      storageBucket: "training-gmiproject.firebasestorage.app",
      messagingSenderId: "188178811217",
      appId: "1:188178811217:web:636b61392f7e302b046b70",
      measurementId: "G-F6DBMTSTLR"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.signInWithEmailAndPassword(email, password)
        .then(() => window.location.href = "forum.html")
        .catch(err => alert(err.message));
    }
  </script>
</head>
<body>
  <h2>Login</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <p>Belum punya akun? <a href="register.html">Register</a></p>
</body>
</html>

<!-- FILE: register.html -->
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Register - GMI Forum</title>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD6Xx37x_IOCh67eoq3CdVNwEchvfiCgBA",
      authDomain: "training-gmiproject.firebaseapp.com",
      projectId: "training-gmiproject",
      storageBucket: "training-gmiproject.firebasestorage.app",
      messagingSenderId: "188178811217",
      appId: "1:188178811217:web:636b61392f7e302b046b70",
      measurementId: "G-F6DBMTSTLR"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    function register() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.createUserWithEmailAndPassword(email, password)
        .then(() => window.location.href = "forum.html")
        .catch(err => alert(err.message));
    }
  </script>
</head>
<body>
  <h2>Register</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button onclick="register()">Register</button>
</body>
</html>

<!-- FILE: update.html -->
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Tambah Status - GMI Forum</title>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD6Xx37x_IOCh67eoq3CdVNwEchvfiCgBA",
      authDomain: "training-gmiproject.firebaseapp.com",
      projectId: "training-gmiproject",
      storageBucket: "training-gmiproject.firebasestorage.app",
      messagingSenderId: "188178811217",
      appId: "1:188178811217:web:636b61392f7e302b046b70",
      measurementId: "G-F6DBMTSTLR"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    auth.onAuthStateChanged(user => {
      if (!user) window.location.href = "login.html";
    });

    function submitPost() {
      const user = auth.currentUser;
      const desc = document.getElementById("desc").value;
      if (desc) {
        db.ref("forum").push({
          email: user.email,
          deskripsi: desc,
          timestamp: Date.now()
        }).then(() => window.location.href = "forum.html");
      }
    }
  </script>
</head>
<body>
  <h2>Tambah Status</h2>
  <textarea id="desc" placeholder="Tulis deskripsi..."></textarea>
  <button onclick="submitPost()">Posting</button>
</body>
</html>

<!-- FILE: forum.html -->
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>GMI | Forum</title>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .logo { font-weight: bold; }
    .post { border: 1px solid #ccc; padding: 10px; margin-top: 10px; border-radius: 6px; }
    .comment-box { margin-top: 10px; }
  </style>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD6Xx37x_IOCh67eoq3CdVNwEchvfiCgBA",
      authDomain: "training-gmiproject.firebaseapp.com",
      projectId: "training-gmiproject",
      storageBucket: "training-gmiproject.firebasestorage.app",
      messagingSenderId: "188178811217",
      appId: "1:188178811217:web:636b61392f7e302b046b70",
      measurementId: "G-F6DBMTSTLR"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    auth.onAuthStateChanged(user => {
      if (!user) return window.location.href = "login.html";
      tampilkanForum();
    });

    function tampilkanForum() {
      const list = document.getElementById("list");
      db.ref("forum").on("value", snap => {
        list.innerHTML = "";
        const data = snap.val();
        if (data) {
          Object.entries(data).reverse().forEach(([id, post]) => {
            const div = document.createElement("div");
            div.className = "post";
            div.innerHTML = `
              <strong>${post.email}</strong>
              <p>${post.deskripsi}</p>
              <div class="comment-box">
                <input type="text" id="komen-${id}" placeholder="Tulis komentar">
                <button onclick="kirimKomentar('${id}')">Kirim</button>
                <div id="komentar-${id}"></div>
              </div>
            `;
            list.appendChild(div);
            tampilKomentar(id);
          });
        }
      });
    }

    function kirimKomentar(postId) {
      const user = auth.currentUser;
      const val = document.getElementById(`komen-${postId}`).value;
      if (val.trim()) {
        db.ref(`forum/${postId}/komentar`).push({
          teks: val,
          email: user.email
        });
        document.getElementById(`komen-${postId}`).value = "";
      }
    }

    function tampilKomentar(postId) {
      const el = document.getElementById(`komentar-${postId}`);
      db.ref(`forum/${postId}/komentar`).on("value", snap => {
        el.innerHTML = "";
        const data = snap.val();
        if (data) {
          Object.values(data).forEach(k => {
            const p = document.createElement("p");
            p.innerHTML = `<small><b>${k.email}</b>: ${k.teks}</small>`;
            el.appendChild(p);
          });
        }
      });
    }
  </script>
</head>
<body>
  <header>
    <div class="logo">GMI | forum</div>
    <button onclick="window.location.href='update.html'">+ Tambah</button>
  </header>
  <div id="list"></div>
</body>
</html>
