<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Forum</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .status-box { border: 1px solid #ccc; padding: 10px; margin-bottom: 15px; border-radius: 5px; }
    .status-image { max-width: 100%; height: auto; margin-top: 10px; }
    .actions button { margin-right: 10px; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
    .modal-content { background: white; padding: 20px; border-radius: 5px; width: 90%; max-width: 400px; }
  </style>
</head>
<body>

<header>
  <div>
    <img src="logo.png" alt="logo" style="height: 40px; vertical-align: middle;">
    <span style="font-size: 24px; font-weight: bold;">FORUM</span>
  </div>
  <button onclick="window.location.href='update.html'">Posting</button>
</header>

<div id="statusList"></div>

<!-- Modal Login/Register -->
<div id="loginModal" class="modal">
  <div class="modal-content">
    <h3>Login / Daftar</h3>
    <input type="email" id="email" placeholder="Email"><br><br>
    <input type="password" id="password" placeholder="Password"><br><br>
    <button onclick="login()">Login</button>
    <button onclick="register()">Daftar</button>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getFirestore, collection, query, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
  import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBrhBBX1CIt5JzCh25tPUwqHJjIVIeyef8",
    authDomain: "gmi-official21-74326.firebaseapp.com",
    projectId: "gmi-official21-74326",
    storageBucket: "gmi-official21-74326.firebasestorage.app",
    messagingSenderId: "496607636364",
    appId: "1:496607636364:web:5c0428ccad6952faa544a9",
    measurementId: "G-KJ0X8CY03M"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  const loginModal = document.getElementById("loginModal");
  let currentUser = null;

  onAuthStateChanged(auth, async user => {
    if (user) {
      currentUser = user;
      loginModal.style.display = "none";
      loadStatuses();
    } else {
      loginModal.style.display = "flex";
    }
  });

  async function login() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    try {
      await signInWithEmailAndPassword(auth, email, password);
    } catch (e) {
      alert("Login gagal: " + e.message);
    }
  }

  async function register() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    try {
      await createUserWithEmailAndPassword(auth, email, password);
    } catch (e) {
      alert("Registrasi gagal: " + e.message);
    }
  }

  async function loadStatuses() {
    const q = query(collection(db, "statuses"), orderBy("createdAt", "desc"));
    const querySnapshot = await getDocs(q);
    const statusList = document.getElementById("statusList");
    statusList.innerHTML = "";

    querySnapshot.forEach(doc => {
      const data = doc.data();
      const box = document.createElement("div");
      box.className = "status-box";

      const desc = document.createElement("p");
      desc.textContent = data.description;

      box.appendChild(desc);

      if (data.imageUrl) {
        const img = document.createElement("img");
        img.src = data.imageUrl;
        img.className = "status-image";
        box.appendChild(img);
      }

      const actions = document.createElement("div");
      actions.className = "actions";

      const commentBtn = document.createElement("button");
      commentBtn.textContent = "Komentar";
      commentBtn.onclick = () => alert("Fitur komentar akan ditambahkan.");

      const reportBtn = document.createElement("button");
      reportBtn.textContent = "Laporkan!";
      reportBtn.onclick = () => {
        const waText = encodeURIComponent(`Saya ingin melaporkan status:\n\n"${data.description}"\n\noleh: ${data.name}`);
        window.open(`https://wa.me/6281234567890?text=${waText}`, '_blank');
      };

      actions.appendChild(commentBtn);
      actions.appendChild(reportBtn);
      box.appendChild(actions);

      statusList.appendChild(box);
    });
  }
</script>

</body>
</html>
