<html class="scroll-smooth" lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   GMI Official App
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
      font-family: 'Inter', sans-serif;
    }
    /* Scrollbar for modal comments */
    .scrollbar-thin::-webkit-scrollbar {
      width: 6px;
    }
    .scrollbar-thin::-webkit-scrollbar-track {
      background: transparent;
    }
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background-color: rgba(100, 100, 100, 0.5);
      border-radius: 3px;
    }
  </style>
 </head>
 <body class="bg-gray-50 min-h-screen flex flex-col">
  <script type="module">
   import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-analytics.js";
  import {
    getAuth,
    onAuthStateChanged,
    signOut,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
  } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";
  import {
    getFirestore,
    collection,
    query,
    where,
    orderBy,
    limit,
    onSnapshot,
    addDoc,
    serverTimestamp,
    doc,
    updateDoc,
    arrayUnion,
    arrayRemove,
    deleteDoc,
    getDoc,
    setDoc,
  } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";
  import {
    getStorage,
    ref,
    uploadBytes,
    getDownloadURL,
  } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-storage.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBggKVSzDyI-meBSL3BMjA736Ss-j_My0E",
    authDomain: "gmi-enterprise23.firebaseapp.com",
    projectId: "gmi-enterprise23",
    storageBucket: "gmi-enterprise23.firebasestorage.app",
    messagingSenderId: "974090028804",
    appId: "1:974090028804:web:43ae563ffd9433463c7251",
    measurementId: "G-S27YB5Z8PR",
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const storage = getStorage(app);

  // Imgur Client ID
  const IMGUR_CLIENT_ID = "0f3d0dc555fdb38";

  // Global state
  let currentUser = null;
  let userData = null;
  let statusesUnsub = null;
  let commentsUnsubMap = new Map();

  // Elements
  const headerRightBtn = document.getElementById("header-options-btn");
  const headerOptionsMenu = document.getElementById("header-options-menu");
  const aboutAppContent = document.getElementById("aboutapp-content");
  const mainContent = document.getElementById("main-content");
  const footerButtons = document.querySelectorAll(".footer-btn");
  const iframeContainer = document.getElementById("iframe-container");
  const forumContainer = document.getElementById("forum-container");
  const profileContainer = document.getElementById("profile-container");
  const postInputBox = document.getElementById("post-input-box");
  const postInputArea = document.getElementById("post-input-area");
  const postImageInput = document.getElementById("post-image-input");
  const postSubmitBtn = document.getElementById("post-submit-btn");
  const commentsModal = document.getElementById("comments-modal");
  const commentsModalCloseBtn = document.getElementById("comments-modal-close");
  const commentsModalHeader = document.getElementById("comments-modal-header");
  const commentsList = document.getElementById("comments-list");
  const commentInput = document.getElementById("comment-input");
  const commentSendBtn = document.getElementById("comment-send-btn");
  const reportModal = document.getElementById("report-modal");
  const reportModalCloseBtn = document.getElementById("report-modal-close");
  const reportOptions = document.getElementById("report-options");
  const reportSendBtn = document.getElementById("report-send-btn");
  const reportReasonSelect = document.getElementById("report-reason-select");
  const referralCopyBtn = document.getElementById("referral-copy-btn");
  const userPointsText = document.getElementById("user-points-text");
  const userNameText = document.getElementById("user-name-text");
  const userEmailText = document.getElementById("user-email-text");
  const userReferralText = document.getElementById("user-referral-text");
  const loadingOverlay = document.getElementById("loading-overlay");

  // Containers
  const loginSection = document.getElementById("login");
  const registerSection = document.getElementById("register");
  const appContainer = document.getElementById("app-container");

  // Registration form elements
  const regStep1 = document.getElementById('step1');
  const regStep2 = document.getElementById('step2');
  const nextBtn = document.getElementById('nextBtn');
  const backBtn = document.getElementById('backBtn');
  const regForm = document.getElementById('registrationForm');
  const successMessage = document.getElementById('successMessage');
  const loadingSpinner = document.getElementById('loadingSpinner');
  const submitBtn = document.getElementById('submitBtn');

  // Inputs Step 1
  const fullNameInput = document.getElementById('fullName');
  const addressInput = document.getElementById('address');
  const emailInput = document.getElementById('email');

  // Inputs Step 2
  const passwordInput = document.getElementById('password');
  const whatsappInput = document.getElementById('whatsapp');
  const referralInput = document.getElementById('referral');

  // Error elements
  const fullNameError = document.getElementById('fullNameError');
  const addressError = document.getElementById('addressError');
  const emailError = document.getElementById('emailError');
  const passwordError = document.getElementById('passwordError');
  const passwordStrength = document.getElementById('passwordStrength');
  const whatsappError = document.getElementById('whatsappError');

  // Login form elements
  const loginForm = document.getElementById("loginForm");
  const loginEmailInput = document.getElementById("loginEmail");
  const loginPasswordInput = document.getElementById("loginPassword");
  const loginError = document.getElementById("loginError");
  const toRegisterLink = document.getElementById("toRegister");
  const toLoginLink = document.getElementById("toLogin");

  // Validation functions
  function validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email.toLowerCase());
  }

  function validateWhatsapp(number) {
    const re = /^08\d+$/;
    return re.test(number);
  }

  function validatePasswordStrength(password) {
    let score = 0;
    if (password.length >= 8) score++;
    if (/[A-Z]/.test(password)) score++;
    if (/[a-z]/.test(password)) score++;
    if (/\d/.test(password)) score++;
    if (/[\W_]/.test(password)) score++;

    if (score <= 2) return { strength: 'Lemah', color: 'text-red-600' };
    if (score === 3) return { strength: 'Sedang', color: 'text-yellow-500' };
    if (score >= 4) return { strength: 'Kuat', color: 'text-green-600' };
  }

  function showError(element, message) {
    element.textContent = message;
    element.classList.remove('hidden');
  }

  function hideError(element) {
    element.textContent = '';
    element.classList.add('hidden');
  }

  // Step 1 validation
  function validateStep1() {
    let valid = true;

    if (!fullNameInput.value.trim()) {
      showError(fullNameError, 'Nama lengkap wajib diisi.');
      valid = false;
    } else {
      hideError(fullNameError);
    }

    if (!addressInput.value.trim()) {
      showError(addressError, 'Alamat wajib diisi.');
      valid = false;
    } else {
      hideError(addressError);
    }

    if (!emailInput.value.trim()) {
      showError(emailError, 'Email wajib diisi.');
      valid = false;
    } else if (!validateEmail(emailInput.value.trim())) {
      showError(emailError, 'Format email tidak valid.');
      valid = false;
    } else {
      hideError(emailError);
    }

    return valid;
  }

  // Step 2 validation
  function validateStep2() {
    let valid = true;

    if (!passwordInput.value) {
      showError(passwordError, 'Kata sandi wajib diisi.');
      valid = false;
    } else if (passwordInput.value.length < 8) {
      showError(passwordError, 'Kata sandi minimal 8 karakter.');
      valid = false;
    } else {
      hideError(passwordError);
    }

    if (!whatsappInput.value.trim()) {
      showError(whatsappError, 'Nomor WhatsApp wajib diisi.');
      valid = false;
    } else if (!validateWhatsapp(whatsappInput.value.trim())) {
      showError(whatsappError, 'Nomor WhatsApp harus diawali dengan "08" dan hanya angka.');
      valid = false;
    } else {
      hideError(whatsappError);
    }

    return valid;
  }

  passwordInput.addEventListener('input', () => {
    const val = passwordInput.value;
    if (!val) {
      passwordStrength.textContent = '';
      passwordStrength.className = '';
      return;
    }
    const { strength, color } = validatePasswordStrength(val);
    passwordStrength.textContent = `Kekuatan kata sandi: ${strength}`;
    passwordStrength.className = `mt-1 text-sm font-medium ${color}`;
  });

  nextBtn.addEventListener('click', () => {
    if (validateStep1()) {
      regStep1.classList.add('hidden');
      regStep2.classList.remove('hidden');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  });

  backBtn.addEventListener('click', () => {
    regStep2.classList.add('hidden');
    regStep1.classList.remove('hidden');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  regForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    if (!validateStep2()) {
      return;
    }

    submitBtn.disabled = true;
    loadingSpinner.classList.remove('hidden');

    const fullName = fullNameInput.value.trim();
    const address = addressInput.value.trim();
    const email = emailInput.value.trim().toLowerCase();
    const password = passwordInput.value;
    const whatsapp = whatsappInput.value.trim();
    const referral = referralInput.value.trim() || null;

    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;

      await setDoc(doc(db, "users", user.uid), {
        fullName,
        address,
        email,
        whatsapp,
        referral,
        createdAt: serverTimestamp(),
        points: 0,
      });

      successMessage.classList.remove('hidden');
      regForm.classList.add('hidden');

      setTimeout(() => {
        successMessage.classList.add('hidden');
        regForm.reset();
        regStep2.classList.add('hidden');
        regStep1.classList.remove('hidden');
        regForm.classList.remove('hidden');
        showLoginSection();
      }, 2500);

    } catch (error) {
      submitBtn.disabled = false;
      loadingSpinner.classList.add('hidden');

      let message = 'Terjadi kesalahan saat registrasi.';
      if (error.code === 'auth/email-already-in-use') {
        message = 'Email sudah terdaftar.';
        showError(emailError, message);
        regStep2.classList.add('hidden');
        regStep1.classList.remove('hidden');
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } else if (error.code === 'auth/invalid-email') {
        message = 'Email tidak valid.';
        showError(emailError, message);
        regStep2.classList.add('hidden');
        regStep1.classList.remove('hidden');
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } else if (error.code === 'auth/weak-password') {
        message = 'Kata sandi terlalu lemah.';
        showError(passwordError, message);
        regStep2.classList.remove('hidden');
        regStep1.classList.add('hidden');
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } else {
        alert(message + ' ' + error.message);
      }
    }
  });

  loginForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    loginError.classList.add("hidden");
    const email = loginEmailInput.value.trim().toLowerCase();
    const password = loginPasswordInput.value;

    if (!email || !password) {
      loginError.textContent = "Email dan kata sandi wajib diisi.";
      loginError.classList.remove("hidden");
      return;
    }

    try {
      await signInWithEmailAndPassword(auth, email, password);
      showApp();
    } catch (error) {
      let message = "Gagal login. Periksa email dan kata sandi Anda.";
      if (error.code === "auth/user-not-found") {
        message = "Pengguna tidak ditemukan.";
      } else if (error.code === "auth/wrong-password") {
        message = "Kata sandi salah.";
      }
      loginError.textContent = message;
      loginError.classList.remove("hidden");
    }
  });

  toRegisterLink.addEventListener("click", (e) => {
    e.preventDefault();
    showRegisterSection();
  });

  toLoginLink.addEventListener("click", (e) => {
    e.preventDefault();
    showLoginSection();
  });

  function showLoginSection() {
    loginSection.classList.remove("hidden");
    registerSection.classList.add("hidden");
    appContainer.classList.add("hidden");
  }

  function showRegisterSection() {
    loginSection.classList.add("hidden");
    registerSection.classList.remove("hidden");
    appContainer.classList.add("hidden");
  }

  function showApp() {
    loginSection.classList.add("hidden");
    registerSection.classList.add("hidden");
    appContainer.classList.remove("hidden");
    loadUserData().then(() => {
      initApp();
    });
  }

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      showLoginSection();
      currentUser = null;
      userData = null;
      return;
    }
    currentUser = user;
    showApp();
  });

  async function loadUserData() {
    const userDoc = await getDoc(doc(db, "users", currentUser.uid));
    if (userDoc.exists()) {
      userData = userDoc.data();
    } else {
      userData = {
        fullName: currentUser.displayName || "User",
        email: currentUser.email,
        whatsapp: "",
        referral: "",
        address: "",
        createdAt: new Date(),
        points: 0,
      };
      await setDoc(doc(db, "users", currentUser.uid), userData);
    }
  }

  // Header options toggle
  headerRightBtn.addEventListener("click", () => {
    headerOptionsMenu.classList.toggle("hidden");
  });

  document.addEventListener("click", (e) => {
    if (
      !headerRightBtn.contains(e.target) &&
      !headerOptionsMenu.contains(e.target)
    ) {
      headerOptionsMenu.classList.add("hidden");
    }
  });

  headerOptionsMenu.querySelectorAll("button[data-spa]").forEach((btn) => {
    btn.addEventListener("click", () => {
      const spaPage = btn.getAttribute("data-spa");
      if (spaPage === "@aboutapp") {
        showAboutApp();
      } else {
        showSPA(spaPage);
      }
      headerOptionsMenu.classList.add("hidden");
    });
  });

  const SPA_PAGES = {
    settings: `<div class="p-6 max-w-xl mx-auto text-gray-700">
      <h2 class="text-2xl font-semibold mb-4">Settings</h2>
      <p>Settings page content coming soon.</p>
    </div>`,
    contact: `<div class="p-6 max-w-xl mx-auto text-gray-700">
      <h2 class="text-2xl font-semibold mb-4">Contact</h2>
      <p>You can contact us at <a href="mailto:support@gmi.com" class="text-blue-600 underline">support@gmi.com</a>.</p>
    </div>`,
    aboutapp: `<div class="p-6 max-w-3xl mx-auto text-gray-800 space-y-6">
      <h2 class="text-3xl font-bold mb-4 text-center">Privacy Policy & Terms</h2>
      <section>
        <h3 class="text-xl font-semibold mb-2">Privacy Policy (Kebijakan Privasi)</h3>
        <p>Menjelaskan bagaimana data pengguna dikumpulkan, digunakan, dan dilindungi. Kami menghargai privasi Anda dan berkomitmen untuk melindungi informasi pribadi Anda sesuai dengan peraturan yang berlaku.</p>
      </section>
      <section>
        <h3 class="text-xl font-semibold mb-2">Terms of Service / Terms and Conditions (Syarat dan Ketentuan)</h3>
        <p>Menetapkan aturan dan batasan penggunaan layanan. Dengan menggunakan aplikasi ini, Anda setuju untuk mematuhi syarat dan ketentuan yang berlaku.</p>
      </section>
      <section>
        <h3 class="text-xl font-semibold mb-2">Cookie Policy</h3>
        <p>Informasi tentang penggunaan cookie, pelacakan, dan opsi persetujuan pengguna. Kami menggunakan cookie untuk meningkatkan pengalaman pengguna dan menganalisis penggunaan aplikasi.</p>
      </section>
      <section>
        <h3 class="text-xl font-semibold mb-2">Disclaimer (Penafian)</h3>
        <p>Menjelaskan batas tanggung jawab, terutama untuk layanan informasi atau konsultasi. Informasi yang disediakan dalam aplikasi ini adalah untuk tujuan umum dan bukan pengganti nasihat profesional.</p>
      </section>
      <section>
        <h3 class="text-xl font-semibold mb-2">End-User License Agreement (EULA)</h3>
        <p>Perjanjian lisensi antara pengembang dan pengguna akhir aplikasi. Dengan menggunakan aplikasi ini, Anda setuju dengan ketentuan lisensi yang ditetapkan.</p>
      </section>
    </div>`,
    newsupdates: `<div class="p-6 max-w-xl mx-auto text-gray-700">
      <h2 class="text-2xl font-semibold mb-4">News or Updates</h2>
      <ul class="list-disc list-inside space-y-2">
        <li>Update 1: New features added to the app.</li>
        <li>Update 2: Bug fixes and performance improvements.</li>
        <li>Update 3: Upcoming events and announcements.</li>
        <li>Update 4: Community guidelines updated.</li>
        <li>Update 5: New referral program launched.</li>
      </ul>
    </div>`,
  };

  function showSPA(page) {
    forumContainer.classList.add("hidden");
    profileContainer.classList.add("hidden");
    iframeContainer.classList.add("hidden");
    postInputBox.classList.add("hidden");
    forumUploadFooter.classList.add("hidden");
    mainContent.classList.remove("hidden");
    mainContent.innerHTML = SPA_PAGES[page] || "<p>Page not found.</p>";
  }

  function showAboutApp() {
    forumContainer.classList.add("hidden");
    profileContainer.classList.add("hidden");
    iframeContainer.classList.add("hidden");
    postInputBox.classList.add("hidden");
    forumUploadFooter.classList.add("hidden");
    mainContent.classList.remove("hidden");
    mainContent.innerHTML = SPA_PAGES.aboutapp;
  }

  footerButtons.forEach((btn) => {
    btn.addEventListener("click", () => {
      const target = btn.getAttribute("data-target");
      if (target === "home") {
        showHomeIframe();
      } else if (target === "forum") {
        showForum();
      } else if (target === "info") {
        showInfoIframe();
      } else if (target === "about") {
        showAboutIframe();
      } else if (target === "profile") {
        showProfile();
      }
    });
  });

  function showHomeIframe() {
    mainContent.classList.add("hidden");
    forumContainer.classList.add("hidden");
    profileContainer.classList.add("hidden");
    iframeContainer.classList.remove("hidden");
    iframeContainer.innerHTML = `<iframe src="home.html" class="w-full h-full border-0" title="Home Page"></iframe>`;
    postInputBox.classList.add("hidden");
    forumUploadFooter.classList.add("hidden");
  }

  function showInfoIframe() {
    mainContent.classList.add("hidden");
    forumContainer.classList.add("hidden");
    profileContainer.classList.add("hidden");
    iframeContainer.classList.remove("hidden");
    iframeContainer.innerHTML = `<iframe src="informasi.html" class="w-full h-full border-0" title="Informasi Page"></iframe>`;
    postInputBox.classList.add("hidden");
    forumUploadFooter.classList.add("hidden");
  }

  function showAboutIframe() {
    mainContent.classList.add("hidden");
    forumContainer.classList.add("hidden");
    profileContainer.classList.add("hidden");
    iframeContainer.classList.remove("hidden");
    iframeContainer.innerHTML = `<iframe src="tentang.html" class="w-full h-full border-0" title="Tentang Page"></iframe>`;
    postInputBox.classList.add("hidden");
    forumUploadFooter.classList.add("hidden");
  }

  function showProfile() {
    mainContent.classList.add("hidden");
    forumContainer.classList.add("hidden");
    iframeContainer.classList.add("hidden");
    profileContainer.classList.remove("hidden");
    postInputBox.classList.add("hidden");
    forumUploadFooter.classList.add("hidden");
    userPointsText.textContent = userData.points ? userData.points : "0";
    userNameText.textContent = userData.fullName || "";
    userEmailText.textContent = userData.email || "";
    userReferralText.textContent = userData.referral || "";
  }

  function showForum() {
    mainContent.classList.add("hidden");
    iframeContainer.classList.add("hidden");
    profileContainer.classList.add("hidden");
    forumContainer.classList.remove("hidden");
    postInputBox.classList.remove("hidden");
    forumUploadFooter.classList.remove("hidden");
    loadForumPosts();
  }

  async function loadForumPosts() {
    if (statusesUnsub) {
      statusesUnsub();
      statusesUnsub = null;
    }
    forumContainer.innerHTML = `<p class="text-center text-gray-500 mt-6">Loading posts...</p>`;

    const now = Date.now();
    const cutoff = now - 24 * 60 * 60 * 1000;

    const statusesRef = collection(db, "statuses");
    const q = query(
      statusesRef,
      orderBy("timestamp", "desc")
    );

    statusesUnsub = onSnapshot(q, async (snapshot) => {
      const batchDeletes = [];
      const posts = [];
      snapshot.forEach((docSnap) => {
        const data = docSnap.data();
        if (!data.timestamp) return;
        const ts = data.timestamp.toMillis();
        if (ts < cutoff) {
          batchDeletes.push(deleteDoc(doc(db, "statuses", docSnap.id)));
        } else {
          posts.push({ id: docSnap.id, ...data });
        }
      });
      if (batchDeletes.length > 0) {
        await Promise.all(batchDeletes);
      }
      renderForumPosts(posts);
    });
  }

  function renderForumPosts(posts) {
    if (posts.length === 0) {
      forumContainer.innerHTML = `<p class="text-center text-gray-500 mt-6">No posts available.</p>`;
      return;
    }
    forumContainer.innerHTML = "";
    posts.forEach((post) => {
      const postDate = post.timestamp.toDate();
      const dateStr = postDate.toLocaleDateString("id-ID", {
        day: "2-digit",
        month: "long",
        year: "numeric",
      });
      const timeStr = postDate.toLocaleTimeString("id-ID", {
        hour: "2-digit",
        minute: "2-digit",
      });
      const postDiv = document.createElement("div");
      postDiv.className =
        "bg-white rounded-lg shadow p-4 mb-4 max-w-3xl mx-auto break-words";
      postDiv.dataset.postId = post.id;

      const headerDiv = document.createElement("div");
      headerDiv.className = "mb-2";
      headerDiv.innerHTML = `
        <p class="font-semibold text-gray-800">${escapeHtml(post.fullName)}</p>
        <p class="text-xs text-gray-500">${timeStr}, ${dateStr}</p>
      `;

      const contentP = document.createElement("p");
      contentP.className = "mt-2 text-gray-700 whitespace-pre-wrap";
      contentP.textContent = post.deskripsi || "";

      let imgEl = null;
      if (post.gambar) {
        imgEl = document.createElement("img");
        imgEl.src = post.gambar;
        imgEl.alt = `User post image uploaded by ${escapeHtml(post.fullName)}`;
        imgEl.className = "mt-3 rounded max-h-96 w-full object-contain";
      }

      const actionsDiv = document.createElement("div");
      actionsDiv.className =
        "flex items-center justify-between mt-4 text-gray-600";

      const likeBtn = document.createElement("button");
      likeBtn.className =
        "flex items-center space-x-1 hover:text-blue-600 focus:outline-none";
      likeBtn.innerHTML = `<i class="fas fa-thumbs-up"></i> <span>${post.likeCount || 0}</span>`;
      likeBtn.title = "Like";
      likeBtn.addEventListener("click", () => {
        toggleLike(post.id);
      });

      const commentBtn = document.createElement("button");
      commentBtn.className =
        "flex items-center space-x-1 hover:text-green-600 focus:outline-none";
      commentBtn.innerHTML = `<i class="fas fa-comment"></i> <span>Komentar</span>`;
      commentBtn.title = "Komentar";
      commentBtn.addEventListener("click", () => {
        openCommentsModal(post.id);
      });

      const reportBtn = document.createElement("button");
      reportBtn.className =
        "flex items-center space-x-1 hover:text-red-600 focus:outline-none";
      reportBtn.innerHTML = `<i class="fas fa-flag"></i> <span>Report</span>`;
      reportBtn.title = "Report";
      reportBtn.addEventListener("click", () => {
        openReportModal(post.id);
      });

      actionsDiv.appendChild(likeBtn);
      actionsDiv.appendChild(commentBtn);
      actionsDiv.appendChild(reportBtn);

      postDiv.appendChild(headerDiv);
      postDiv.appendChild(contentP);
      if (imgEl) postDiv.appendChild(imgEl);
      postDiv.appendChild(actionsDiv);

      forumContainer.appendChild(postDiv);
    });
  }

  function escapeHtml(text) {
    if (!text) return "";
    return text
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }

  async function toggleLike(postId) {
    if (!currentUser) return;
    const postRef = doc(db, "statuses", postId);
    const postSnap = await getDoc(postRef);
    if (!postSnap.exists()) return;
    const postData = postSnap.data();
    let likedBy = postData.likedBy || [];
    let likeCount = postData.likeCount || 0;
    if (likedBy.includes(currentUser.uid)) {
      likedBy = likedBy.filter((uid) => uid !== currentUser.uid);
      likeCount = Math.max(0, likeCount - 1);
    } else {
      likedBy.push(currentUser.uid);
      likeCount++;
    }
    await updateDoc(postRef, {
      likedBy,
      likeCount,
    });
  }

  let currentCommentPostId = null;
  commentsModalCloseBtn.addEventListener("click", closeCommentsModal);
  commentSendBtn.addEventListener("click", sendComment);

  function openCommentsModal(postId) {
    currentCommentPostId = postId;
    commentsModal.classList.remove("hidden");
    commentsList.innerHTML = `<p class="text-center text-gray-500 py-6">Loading comments...</p>`;
    loadComments(postId);
  }

  function closeCommentsModal() {
    commentsModal.classList.add("hidden");
    commentsList.innerHTML = "";
    commentInput.value = "";
    currentCommentPostId = null;
  }

  async function loadComments(postId) {
    const commentsRef = collection(db, "statuses", postId, "comments");
    const q = query(commentsRef, orderBy("timestamp", "asc"));
    if (commentsUnsubMap.has(postId)) {
      commentsUnsubMap.get(postId)();
      commentsUnsubMap.delete(postId);
    }
    commentsUnsubMap.set(
      postId,
      onSnapshot(q, (snapshot) => {
        const comments = [];
        snapshot.forEach((docSnap) => {
          comments.push({ id: docSnap.id, ...docSnap.data() });
        });
        renderComments(comments);
      })
    );
  }

  function renderComments(comments) {
    if (comments.length === 0) {
      commentsList.innerHTML = `<p class="text-center text-gray-500 py-6">Belum ada komentar.</p>`;
      return;
    }
    commentsList.innerHTML = "";
    comments.forEach((comment) => {
      const commentDate = comment.timestamp?.toDate();
      const dateStr = commentDate
        ? commentDate.toLocaleDateString("id-ID", {
            day: "2-digit",
            month: "long",
            year: "numeric",
          })
        : "";
      const timeStr = commentDate
        ? commentDate.toLocaleTimeString("id-ID", {
            hour: "2-digit",
            minute: "2-digit",
          })
        : "";
      const commentDiv = document.createElement("div");
      commentDiv.className = "mb-4 border-b border-gray-200 pb-2";

      const headerDiv = document.createElement("div");
      headerDiv.className = "flex justify-between items-center mb-1";
      headerDiv.innerHTML = `
        <p class="font-semibold text-gray-800">${escapeHtml(
          comment.fullName || "Anonymous"
        )}</p>
        <p class="text-xs text-gray-500">${timeStr}, ${dateStr}</p>
      `;

      const textP = document.createElement("p");
      textP.className = "text-gray-700 whitespace-pre-wrap";
      textP.textContent = comment.text || "";

      const replyBtn = document.createElement("button");
      replyBtn.className =
        "text-sm text-blue-600 hover:underline focus:outline-none mt-1";
      replyBtn.textContent = "Reply";
      replyBtn.addEventListener("click", () => {
        openReplyInput(comment.id);
      });

      const repliesDiv = document.createElement("div");
      repliesDiv.className = "ml-6 mt-2 space-y-2";

      if (comment.replies && Array.isArray(comment.replies)) {
        comment.replies.forEach((reply) => {
          const replyDate = reply.timestamp?.toDate();
          const rDateStr = replyDate
            ? replyDate.toLocaleDateString("id-ID", {
                day: "2-digit",
                month: "long",
                year: "numeric",
              })
            : "";
          const rTimeStr = replyDate
            ? replyDate.toLocaleTimeString("id-ID", {
                hour: "2-digit",
                minute: "2-digit",
              })
            : "";
          const replyDiv = document.createElement("div");
          replyDiv.className =
            "bg-gray-100 rounded p-2 border border-gray-300 break-words";
          replyDiv.innerHTML = `
            <p class="font-semibold text-gray-700">${escapeHtml(
              reply.fullName || "Anonymous"
            )}</p>
            <p class="text-gray-700 whitespace-pre-wrap">${escapeHtml(
              reply.text || ""
            )}</p>
            <p class="text-xs text-gray-500 text-right">${rTimeStr}, ${rDateStr}</p>
          `;
          repliesDiv.appendChild(replyDiv);
        });
      }

      commentDiv.appendChild(headerDiv);
      commentDiv.appendChild(textP);
      commentDiv.appendChild(replyBtn);
      commentDiv.appendChild(repliesDiv);

      commentsList.appendChild(commentDiv);
    });
  }

  function openReplyInput(commentId) {
    const existingReplyInput = document.getElementById("reply-input-box");
    if (existingReplyInput) existingReplyInput.remove();

    const commentDiv = [...commentsList.children].find(
      (div) => div.dataset.commentId === commentId
    );
    const targetDiv = commentDiv || commentsList.lastChild;

    const replyBox = document.createElement("div");
    replyBox.id = "reply-input-box";
    replyBox.className = "mt-2 flex space-x-2";

    const replyInput = document.createElement("input");
    replyInput.type = "text";
    replyInput.placeholder = "Tulis reply...";
    replyInput.className =
      "flex-grow border border-gray-300 rounded px-3 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500";

    const replySendBtn = document.createElement("button");
    replySendBtn.textContent = "Send";
    replySendBtn.className =
      "bg-blue-600 text-white px-4 rounded hover:bg-blue-700 focus:outline-none";
    replySendBtn.addEventListener("click", () => {
      sendReply(commentId, replyInput.value);
      replyInput.value = "";
      replyBox.remove();
    });

    replyBox.appendChild(replyInput);
    replyBox.appendChild(replySendBtn);

    if (targetDiv) {
      targetDiv.appendChild(replyBox);
      replyInput.focus();
    }
  }

  async function sendComment() {
    if (!currentCommentPostId) return;
    const text = commentInput.value.trim();
    if (!text) return;
    const commentsRef = collection(
      db,
      "statuses",
      currentCommentPostId,
      "comments"
    );
    await addDoc(commentsRef, {
      text,
      fullName: userData.fullName || "Anonymous",
      uid: currentUser.uid,
      timestamp: serverTimestamp(),
      replies: [],
    });
    commentInput.value = "";
  }

  async function sendReply(commentId, text) {
    if (!currentCommentPostId || !commentId || !text.trim()) return;
    const commentRef = doc(
      db,
      "statuses",
      currentCommentPostId,
      "comments",
      commentId
    );
    const commentSnap = await getDoc(commentRef);
    if (!commentSnap.exists()) return;
    const commentData = commentSnap.data();
    const newReply = {
      text: text.trim(),
      fullName: userData.fullName || "Anonymous",
      uid: currentUser.uid,
      timestamp: serverTimestamp(),
    };
    const updatedReplies = commentData.replies ? [...commentData.replies] : [];
    updatedReplies.push(newReply);
    await updateDoc(commentRef, {
      replies: updatedReplies,
    });
  }

  let currentReportPostId = null;
  reportModalCloseBtn.addEventListener("click", () => {
    reportModal.classList.add("hidden");
    reportReasonSelect.value = "";
  });
  reportSendBtn.addEventListener("click", () => {
    sendReport();
  });

  function openReportModal(postId) {
    currentReportPostId = postId;
    reportModal.classList.remove("hidden");
  }

  function sendReport() {
    const reason = reportReasonSelect.value;
    if (!reason) {
      alert("Please select a reason for reporting.");
      return;
    }
    const waNumber = "+628119118047";
    const message = encodeURIComponent(
      `Report for post ID: ${currentReportPostId}\nReason: ${reason}`
    );
    window.open(`https://wa.me/${waNumber.replace(/\D/g, "")}?text=${message}`, "_blank");
    reportModal.classList.add("hidden");
    reportReasonSelect.value = "";
  }

  postInputBox.addEventListener("click", () => {
    window.location.href = "update.html";
  });

  referralCopyBtn.addEventListener("click", () => {
    if (!userReferralText.textContent) return;
    navigator.clipboard.writeText(userReferralText.textContent).then(() => {
      alert("Kode referral berhasil disalin!");
    });
  });

  function initApp() {
    showHomeIframe();
  }

  // Forum upload footer elements and logic
  const forumUploadFooter = document.getElementById("forum-upload-footer");
  const uploadTextArea = document.getElementById("upload-textarea");
  const uploadImageInput = document.getElementById("upload-image-input");
  const uploadImagePreview = document.getElementById("upload-image-preview");
  const uploadSubmitBtn = document.getElementById("upload-submit-btn");
  const uploadCancelBtn = document.getElementById("upload-cancel-btn");
  const uploadLoadingSpinner = document.getElementById("upload-loading-spinner");

  let uploadImageFile = null;

  uploadImageInput.addEventListener("change", () => {
    const file = uploadImageInput.files[0];
    if (file) {
      uploadImageFile = file;
      const url = URL.createObjectURL(file);
      uploadImagePreview.src = url;
      uploadImagePreview.classList.remove("hidden");
    } else {
      uploadImageFile = null;
      uploadImagePreview.src = "";
      uploadImagePreview.classList.add("hidden");
    }
  });

  uploadCancelBtn.addEventListener("click", () => {
    uploadTextArea.value = "";
    uploadImageInput.value = "";
    uploadImagePreview.src = "";
    uploadImagePreview.classList.add("hidden");
    uploadImageFile = null;
  });

  uploadSubmitBtn.addEventListener("click", async () => {
    const text = uploadTextArea.value.trim();
    if (!text && !uploadImageFile) {
      alert("Tulis sesuatu atau pilih gambar untuk diposting.");
      return;
    }
    uploadSubmitBtn.disabled = true;
    uploadLoadingSpinner.classList.remove("hidden");

    try {
      let imageUrl = null;
      if (uploadImageFile) {
        imageUrl = await uploadImageToImgur(uploadImageFile);
      }

      await addDoc(collection(db, "statuses"), {
        deskripsi: text,
        fullName: userData.fullName || "Anonymous",
        gambar: imageUrl,
        likeCount: 0,
        likedBy: [],
        timestamp: serverTimestamp(),
        uid: currentUser.uid,
      });

      uploadTextArea.value = "";
      uploadImageInput.value = "";
      uploadImagePreview.src = "";
      uploadImagePreview.classList.add("hidden");
      uploadImageFile = null;

      loadForumPosts();

    } catch (error) {
      alert("Gagal memposting: " + error.message);
    } finally {
      uploadSubmitBtn.disabled = false;
      uploadLoadingSpinner.classList.add("hidden");
    }
  });

  async function uploadImageToImgur(file) {
    const formData = new FormData();
    formData.append("image", file);

    const response = await fetch("https://api.imgur.com/3/image", {
      method: "POST",
      headers: {
        Authorization: `Client-ID ${IMGUR_CLIENT_ID}`,
      },
      body: formData,
    });

    const data = await response.json();
    if (!data.success) {
      throw new Error("Upload gambar gagal");
    }
    return data.data.link;
  }
  </script>

  <!-- LOGIN SECTION -->
  <section id="login" class="min-h-screen flex items-center justify-center p-4 bg-gray-50">
    <div class="w-full max-w-md bg-white rounded-lg shadow-lg p-6 sm:p-10">
      <h2 class="text-3xl font-semibold text-gray-700 mb-6 text-center">Login</h2>
      <form id="loginForm" class="space-y-4" novalidate>
        <div>
          <label for="loginEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
          <input type="email" id="loginEmail" name="loginEmail" autocomplete="email" required
            class="w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent" />
        </div>
        <div>
          <label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-1">Kata Sandi</label>
          <input type="password" id="loginPassword" name="loginPassword" required
            class="w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent" />
        </div>
        <p id="loginError" class="text-red-600 text-sm hidden"></p>
        <button type="submit" class="w-full bg-blue-600 text-white px-5 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-700 focus:ring-offset-1 transition">
          Login
        </button>
      </form>
      <p class="mt-6 text-center text-gray-600">
        Belum punya akun? <a href="#" id="toRegister" class="text-blue-600 hover:underline">Daftar di sini</a>
      </p>
    </div>
  </section>

  <!-- REGISTER SECTION -->
  <section id="register" class="hidden min-h-screen flex items-center justify-center p-4 bg-gray-50">
    <div class="w-full max-w-md bg-white rounded-lg shadow-lg p-6 sm:p-10">
      <h1 class="text-3xl font-semibold text-green-700 mb-6 text-center">Registrasi Akun</h1>
      <form id="registrationForm" novalidate>
        <!-- Step 1 -->
        <fieldset id="step1" class="space-y-6">
          <div>
            <label for="fullName" class="block text-sm font-medium text-green-700 mb-1">Nama Lengkap</label>
            <input type="text" id="fullName" name="fullName" autocomplete="name" required
              class="w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-700 focus:border-transparent"
              aria-describedby="fullNameError" />
            <p id="fullNameError" class="mt-1 text-sm text-red-600 hidden"></p>
          </div>
          <div>
            <label for="address" class="block text-sm font-medium text-green-700 mb-1">Alamat</label>
            <input type="text" id="address" name="address" autocomplete="street-address" required
              class="w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-700 focus:border-transparent"
              aria-describedby="addressError" />
            <p id="addressError" class="mt-1 text-sm text-red-600 hidden"></p>
          </div>
          <div>
            <label for="email" class="block text-sm font-medium text-green-700 mb-1">Email</label>
            <input type="email" id="email" name="email" autocomplete="email" required
              class="w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-700 focus:border-transparent"
              aria-describedby="emailError" />
            <p id="emailError" class="mt-1 text-sm text-red-600 hidden"></p>
          </div>
          <div class="flex justify-end">
            <button type="button" id="nextBtn" class="bg-green-700 text-white px-5 py-2 rounded-md hover:bg-green-800 focus:outline-none focus:ring-2 focus:ring-green-800 focus:ring-offset-1 transition">
              Selanjutnya <i class="fas fa-arrow-right ml-2"></i>
            </button>
          </div>
        </fieldset>

        <!-- Step 2 -->
        <fieldset id="step2" class="space-y-6 hidden">
          <div>
            <label for="password" class="block text-sm font-medium text-green-700 mb-1">Kata Sandi</label>
            <input type="password" id="password" name="password" required
              class="w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-700 focus:border-transparent"
              aria-describedby="passwordError passwordStrength" />
            <p id="passwordError" class="mt-1 text-sm text-red-600 hidden"></p>
            <p id="passwordStrength" class="mt-1 text-sm font-medium"></p>
          </div>
          <div>
            <label for="whatsapp" class="block text-sm font-medium text-green-700 mb-1">Nomor WhatsApp</label>
            <input type="text" id="whatsapp" name="whatsapp" inputmode="numeric" pattern="08[0-9]*" required
              placeholder="Contoh: 081234567890"
              class="w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-700 focus:border-transparent"
              aria-describedby="whatsappError" />
            <p id="whatsappError" class="mt-1 text-sm text-red-600 hidden"></p>
          </div>
          <div>
            <label for="referral" class="block text-sm font-medium text-green-700 mb-1">Kode Referral (opsional)</label>
            <input type="text" id="referral" name="referral" autocomplete="off"
              class="w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-700 focus:border-transparent" />
          </div>
          <div class="flex justify-between">
            <button type="button" id="backBtn" class="border border-green-700 text-green-700 px-5 py-2 rounded-md hover:bg-green-100 focus:outline-none focus:ring-2 focus:ring-green-700 focus:ring-offset-1 transition">
              <i class="fas fa-arrow-left mr-2"></i> Kembali
            </button>
            <button type="submit" id="submitBtn" class="bg-green-700 text-white px-5 py-2 rounded-md hover:bg-green-800 focus:outline-none focus:ring-2 focus:ring-green-800 focus:ring-offset-1 transition flex items-center">
              Daftar
              <svg id="loadingSpinner" class="animate-spin ml-2 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" aria-hidden="true">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
              </svg>
            </button>
          </div>
        </fieldset>
      </form>
      <p class="mt-6 text-center text-gray-600">
        Sudah punya akun? <a href="#" id="toLogin" class="text-blue-600 hover:underline">Login di sini</a>
      </p>
      <p id="successMessage" class="mt-6 text-center text-green-600 font-semibold hidden">Registrasi berhasil</p>
    </div>
  </section>

  <!-- APP CONTAINER -->
  <div id="app-container" class="hidden flex flex-col min-h-screen">
    <!-- Header -->
    <header class="flex items-center justify-between bg-white shadow px-4 py-3 sticky top-0 z-40">
      <div class="flex items-center space-x-3">
        <img alt="GMI Official Logo, stylized letters G M I in blue and white" class="w-10 h-10 rounded" height="40" loading="lazy" src="https://storage.googleapis.com/a1aa/image/840f54b7-f384-4cf0-98f1-fc6db0b6f9d4.jpg" width="40"/>
        <span class="font-semibold text-xl text-blue-700 select-none">
          gmi official
        </span>
      </div>
      <div class="relative">
        <button aria-label="Open options menu" class="text-2xl text-gray-600 hover:text-gray-900 focus:outline-none" id="header-options-btn" type="button">
          <i class="fas fa-ellipsis-v"></i>
        </button>
        <div aria-labelledby="header-options-btn" aria-orientation="vertical" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none z-50" id="header-options-menu" role="menu" tabindex="-1">
          <div class="py-1" role="none">
            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-spa="settings" role="menuitem" tabindex="-1" type="button">
              Settings
            </button>
            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-spa="contact" role="menuitem" tabindex="-1" type="button">
              Contact
            </button>
            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-spa="@aboutapp" role="menuitem" tabindex="-1" type="button">
              About Apps
            </button>
            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-spa="rateus" role="menuitem" tabindex="-1" type="button">
              Rate Us
            </button>
            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-spa="newsupdates" role="menuitem" tabindex="-1" type="button">
              News or Updates
            </button>
          </div>
        </div>
      </div>
    </header>
    <!-- Main content container -->
    <main class="flex-grow relative overflow-hidden">
      <!-- SPA main content -->
      <div class="hidden p-4 max-w-4xl mx-auto min-h-[calc(100vh-168px)] overflow-y-auto" id="main-content"></div>
      <!-- iframe container for home, info, about -->
      <div class="hidden w-full h-[calc(100vh-168px)]" id="iframe-container"></div>
      <!-- Forum container -->
      <section class="hidden p-4 max-w-4xl mx-auto min-h-[calc(100vh-168px)] overflow-y-auto" id="forum-container"></section>
      <!-- Profile container -->
      <section class="hidden p-6 max-w-md mx-auto min-h-[calc(100vh-168px)] bg-white rounded-lg shadow mt-4" id="profile-container">
        <h2 class="text-3xl font-extrabold text-blue-700 mb-6 text-center">Profil User</h2>
        <div class="mb-6 text-center">
          <p class="text-5xl font-extrabold text-gray-900" id="user-points-text">0</p>
          <p class="text-sm text-gray-500">Saldo Point</p>
        </div>
        <div class="space-y-4 text-gray-700">
          <div>
            <h3 class="font-semibold">Nama Lengkap</h3>
            <p class="text-lg" id="user-name-text"></p>
          </div>
          <div>
            <h3 class="font-semibold">Email</h3>
            <p class="text-lg break-all" id="user-email-text"></p>
          </div>
          <div>
            <h3 class="font-semibold flex items-center justify-between">
              Kode Referral
              <button class="text-sm bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 focus:outline-none" id="referral-copy-btn" type="button">Salin</button>
            </h3>
            <p class="text-lg break-all select-text" id="user-referral-text"></p>
          </div>
        </div>
      </section>
    </main>
    <!-- Post input box for forum -->
    <div class="fixed bottom-16 left-0 right-0 max-w-4xl mx-auto px-4" id="post-input-box">
      <div class="bg-white rounded-full shadow flex items-center px-4 py-3 cursor-pointer hover:shadow-md transition-shadow">
        <input class="flex-grow text-gray-700 text-lg focus:outline-none cursor-pointer" id="post-input-area" placeholder="Katakan sesuatu..." readonly="" type="text"/>
        <label class="ml-3 cursor-pointer text-gray-500 hover:text-gray-700" for="post-image-input" title="Upload gambar">
          <i class="fas fa-image text-2xl"></i>
        </label>
        <input accept="image/*" class="hidden" disabled="" id="post-image-input" type="file"/>
        <button class="ml-3 bg-blue-600 text-white px-4 py-2 rounded-full opacity-50 cursor-not-allowed" disabled="" id="post-submit-btn" type="button">Post</button>
      </div>
    </div>
    <!-- Forum upload footer -->
    <footer id="forum-upload-footer" class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-300 shadow flex flex-col p-4 max-w-4xl mx-auto z-50 hidden">
      <textarea id="upload-textarea" rows="3" placeholder="Tulis sesuatu..." class="w-full rounded-md border border-gray-300 p-2 resize-none focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent"></textarea>
      <div class="flex items-center mt-2 space-x-3">
        <label for="upload-image-input" class="cursor-pointer text-gray-600 hover:text-gray-900">
          <i class="fas fa-image text-2xl"></i>
          <span class="sr-only">Upload gambar</span>
        </label>
        <input type="file" id="upload-image-input" accept="image/*" class="hidden" />
        <img id="upload-image-preview" alt="Preview gambar yang akan diupload" class="hidden max-h-24 rounded object-contain" />
        <div class="flex-grow"></div>
        <button id="upload-cancel-btn" type="button" class="text-red-600 hover:text-red-800 focus:outline-none">
          <i class="fas fa-times text-xl"></i>
          <span class="sr-only">Batal</span>
        </button>
        <button id="upload-submit-btn" type="button" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 focus:outline-none flex items-center">
          Post
          <svg id="upload-loading-spinner" class="animate-spin ml-2 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" aria-hidden="true">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
          </svg>
        </button>
      </div>
    </footer>
  </div>

  <!-- Comments modal -->
  <div aria-labelledby="comments-modal-header" aria-modal="true" class="fixed inset-0 bg-black bg-opacity-50 flex flex-col justify-center items-center p-4 hidden z-50" id="comments-modal" role="dialog">
   <div class="bg-white rounded-lg max-w-3xl w-full max-h-[90vh] flex flex-col overflow-hidden">
    <header class="flex justify-between items-center border-b border-gray-300 px-4 py-3">
     <h3 class="text-xl font-semibold text-gray-800 text-center flex-grow" id="comments-modal-header">
      Komentar
     </h3>
     <button aria-label="Close comments modal" class="text-gray-600 hover:text-gray-900 focus:outline-none" id="comments-modal-close" type="button">
      <i class="fas fa-times text-2xl"></i>
     </button>
    </header>
    <main class="flex-grow overflow-y-auto p-4 scrollbar-thin" id="comments-list"></main>
    <footer class="border-t border-gray-300 px-4 py-3 flex space-x-2">
     <input class="flex-grow border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" id="comment-input" placeholder="Tulis komentar..." type="text"/>
     <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 focus:outline-none" id="comment-send-btn" type="button">
      Send
     </button>
    </footer>
   </div>
  </div>
  <!-- Report modal -->
  <div aria-labelledby="report-modal-header" aria-modal="true" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center p-4 hidden z-50" id="report-modal" role="dialog">
   <div class="bg-white rounded-lg max-w-md w-full p-6 space-y-4">
    <header class="flex justify-between items-center">
     <h3 class="text-xl font-semibold text-gray-800" id="report-modal-header">
      Laporkan Postingan
     </h3>
     <button aria-label="Close report modal" class="text-gray-600 hover:text-gray-900 focus:outline-none" id="report-modal-close" type="button">
      <i class="fas fa-times text-2xl"></i>
     </button>
    </header>
    <div>
     <label class="block font-semibold mb-2" for="report-reason-select">
      Pilih alasan laporan:
     </label>
     <select class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500" id="report-reason-select">
      <option value="">
       -- Pilih alasan --
      </option>
      <option value="Spam">
       Spam
      </option>
      <option value="Kekerasan Verbal">
       Kekerasan Verbal
      </option>
      <option value="Konten Tidak Pantas">
       Konten Tidak Pantas
      </option>
      <option value="Lainnya">
       Lainnya
      </option>
     </select>
    </div>
    <div class="flex justify-end">
     <button class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 focus:outline-none" id="report-send-btn" type="button">
      Kirim
     </button>
    </div>
   </div>
  </div>
 </body>
</html>
