<html class="scroll-smooth" lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   GMI Official App
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
      font-family: 'Inter', sans-serif;
    }
    /* Scrollbar for comments modal */
    .scrollbar-thin::-webkit-scrollbar {
      width: 6px;
    }
    .scrollbar-thin::-webkit-scrollbar-track {
      background: transparent;
    }
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background-color: rgba(100, 116, 139, 0.5);
      border-radius: 3px;
    }
  </style>
 </head>
 <body class="bg-gray-50 min-h-screen flex flex-col">
  <script type="module">
   import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-analytics.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";
  import { getFirestore, collection, addDoc, query, where, orderBy, onSnapshot, serverTimestamp, deleteDoc, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-storage.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBggKVSzDyI-meBSL3BMjA736Ss-j_My0E",
    authDomain: "gmi-enterprise23.firebaseapp.com",
    projectId: "gmi-enterprise23",
    storageBucket: "gmi-enterprise23.firebasestorage.app",
    messagingSenderId: "974090028804",
    appId: "1:974090028804:web:43ae563ffd9433463c7251",
    measurementId: "G-S27YB5Z8PR"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const storage = getStorage(app);

  // Redirect if not logged in
  onAuthStateChanged(auth, user => {
    if (!user) {
      window.location.href = "login.html";
    } else {
      currentUser = user;
      loadUserProfile();
      loadForumPosts();
      startPostCleanupInterval();
    }
  });

  // Global current user data
  let currentUser = null;

  // Elements references
  const userNameEl = document.getElementById("profile-name");
  const userEmailEl = document.getElementById("profile-email");
  const userPointsEl = document.getElementById("profile-points");
  const userReferralEl = document.getElementById("profile-referral");
  const referralCopyBtn = document.getElementById("referral-copy-btn");

  // Modal elements
  const commentModal = document.getElementById("comment-modal");
  const commentModalCloseBtn = document.getElementById("comment-modal-close");
  const commentListEl = document.getElementById("comment-list");
  const commentInputEl = document.getElementById("comment-input");
  const commentSendBtn = document.getElementById("comment-send-btn");
  const commentReplyToEl = document.getElementById("comment-reply-to");
  const commentReplyCancelBtn = document.getElementById("comment-reply-cancel");

  // Report modal elements
  const reportModal = document.getElementById("report-modal");
  const reportModalCloseBtn = document.getElementById("report-modal-close");
  const reportReasonSelect = document.getElementById("report-reason");
  const reportSendBtn = document.getElementById("report-send-btn");

  // Header menu toggle
  const menuToggleBtn = document.getElementById("header-menu-btn");
  const menuDropdown = document.getElementById("header-menu-dropdown");

  // SPA container
  const spaContainer = document.getElementById("spa-container");

  // Forum container
  const forumContainer = document.getElementById("forum-container");

  // Post input box
  const postInputBox = document.getElementById("post-input-box");

  // Post form elements
  const postTextInput = document.getElementById("post-text-input");
  const postImageInput = document.getElementById("post-image-input");
  const postSubmitBtn = document.getElementById("post-submit-btn");
  const postImagePreview = document.getElementById("post-image-preview");
  const postImageRemoveBtn = document.getElementById("post-image-remove-btn");

  // Iframe container
  const iframeContainer = document.getElementById("iframe-container");

  // SPA pages content
  const aboutAppContent = `
    <div class="p-6 max-w-4xl mx-auto text-gray-800">
      <h2 class="text-3xl font-semibold mb-6">Privacy Policy (Kebijakan Privasi)</h2>
      <p class="mb-4">Menjelaskan bagaimana data pengguna dikumpulkan, digunakan, dan dilindungi.</p>
      <h2 class="text-3xl font-semibold mb-6">Terms of Service / Terms and Conditions (Syarat dan Ketentuan)</h2>
      <p class="mb-4">Menetapkan aturan dan batasan penggunaan layanan.</p>
      <h2 class="text-3xl font-semibold mb-6">Cookie Policy</h2>
      <p class="mb-4">Informasi tentang penggunaan cookie, pelacakan, dan opsi persetujuan pengguna.</p>
      <h2 class="text-3xl font-semibold mb-6">Disclaimer (Penafian)</h2>
      <p class="mb-4">Menjelaskan batas tanggung jawab, terutama untuk layanan informasi atau konsultasi.</p>
      <h2 class="text-3xl font-semibold mb-6">End-User License Agreement (EULA)</h2>
      <p class="mb-4">Perjanjian lisensi antara pengembang dan pengguna akhir aplikasi.</p>
    </div>
  `;

  // State for comments modal
  let currentPostIdForComments = null;
  let currentReplyToCommentId = null;

  // State for report modal
  let currentPostIdForReport = null;

  // Utility: format date/time
  function formatDateTime(timestamp) {
    const d = timestamp.toDate();
    const date = d.toLocaleDateString();
    const time = d.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    return {date, time};
  }

  // Utility: generate referral code (random 8 chars alphanumeric)
  function generateReferralCode() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let code = '';
    for(let i=0; i<8; i++) {
      code += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return code;
  }

  // Load user profile info from Firestore or create if not exist
  async function loadUserProfile() {
    if (!currentUser) return;
    const userDocRef = doc(db, "users", currentUser.uid);
    const userDocSnap = await getDoc(userDocRef);
    if (!userDocSnap.exists()) {
      // Create user doc with default data
      const referralCode = generateReferralCode();
      await addDoc(collection(db, "users"), {
        id: currentUser.uid,
        name: currentUser.displayName || "User",
        email: currentUser.email,
        whatsapp: "",
        referralCode: referralCode,
        points: 0,
        createdAt: serverTimestamp()
      });
      // We will reload after creation
      loadUserProfile();
      return;
    }
    const userData = userDocSnap.data();
    userNameEl.textContent = userData.name || currentUser.displayName || "User";
    userEmailEl.textContent = userData.email || currentUser.email || "";
    userPointsEl.textContent = userData.points !== undefined ? userData.points : 0;
    userReferralEl.textContent = userData.referralCode || "";
  }

  // Copy referral code to clipboard
  referralCopyBtn.addEventListener("click", () => {
    if (userReferralEl.textContent) {
      navigator.clipboard.writeText(userReferralEl.textContent);
      alert("Kode referral disalin ke clipboard");
    }
  });

  // Header menu toggle
  menuToggleBtn.addEventListener("click", () => {
    menuDropdown.classList.toggle("hidden");
  });

  // Close menu if clicked outside
  document.addEventListener("click", (e) => {
    if (!menuToggleBtn.contains(e.target) && !menuDropdown.contains(e.target)) {
      menuDropdown.classList.add("hidden");
    }
  });

  // SPA navigation handler
  function loadSPA(page) {
    menuDropdown.classList.add("hidden");
    forumContainer.classList.add("hidden");
    iframeContainer.classList.add("hidden");
    spaContainer.classList.remove("hidden");
    postInputBox.classList.add("hidden");
    switch(page) {
      case "settings":
        spaContainer.innerHTML = `
          <div class="p-6 max-w-4xl mx-auto text-gray-800">
            <h2 class="text-3xl font-semibold mb-6">Settings</h2>
            <p>Pengaturan aplikasi akan ditampilkan di sini.</p>
          </div>
        `;
        break;
      case "contact":
        spaContainer.innerHTML = `
          <div class="p-6 max-w-4xl mx-auto text-gray-800">
            <h2 class="text-3xl font-semibold mb-6">Contact</h2>
            <p>Hubungi kami melalui email: support@gmi.com atau WhatsApp: +62 811-9118-047</p>
          </div>
        `;
        break;
      case "aboutapp":
        spaContainer.innerHTML = aboutAppContent;
        break;
      case "rateus":
        spaContainer.innerHTML = `
          <div class="p-6 max-w-4xl mx-auto text-gray-800">
            <h2 class="text-3xl font-semibold mb-6">Rate Us</h2>
            <p>Berikan rating dan ulasan Anda di platform favorit Anda.</p>
          </div>
        `;
        break;
      case "news":
        spaContainer.innerHTML = `
          <div class="p-6 max-w-4xl mx-auto text-gray-800">
            <h2 class="text-3xl font-semibold mb-6">News or Updates</h2>
            <ul class="list-disc list-inside space-y-2">
              <li>Update 1: Fitur baru forum telah ditambahkan.</li>
              <li>Update 2: Perbaikan bug dan peningkatan performa.</li>
              <li>Update 3: Penambahan kebijakan privasi terbaru.</li>
              <li>Update 4: Integrasi dengan Imgur untuk upload gambar.</li>
              <li>Update 5: Sistem poin pengguna telah diperbarui.</li>
              <li>Update 6: Penambahan fitur komentar dan reply di forum.</li>
              <li>Update 7: Penambahan tombol report untuk postingan.</li>
              <li>Update 8: Tampilan aplikasi kini lebih responsif dan modern.</li>
              <li>Update 9: Penambahan halaman profil dengan saldo poin dan kode referral.</li>
              <li>Update 10: Perbaikan keamanan dan autentikasi pengguna.</li>
            </ul>
          </div>
        `;
        break;
      default:
        spaContainer.innerHTML = `<div class="p-6 max-w-4xl mx-auto text-gray-800">Halaman tidak ditemukan.</div>`;
    }
  }

  // Iframe page loader
  function loadIframePage(page) {
    spaContainer.classList.add("hidden");
    forumContainer.classList.add("hidden");
    iframeContainer.classList.remove("hidden");
    postInputBox.classList.add("hidden");
    let src = "";
    switch(page) {
      case "home":
        src = "home.html";
        break;
      case "informasi":
        src = "informasi.html";
        break;
      case "tentang":
        src = "tentang.html";
        break;
      default:
        src = "home.html";
    }
    iframeContainer.querySelector("iframe").src = src;
  }

  // Show forum page
  function showForumPage() {
    spaContainer.classList.add("hidden");
    iframeContainer.classList.add("hidden");
    forumContainer.classList.remove("hidden");
    postInputBox.classList.remove("hidden");
  }

  // Navigation buttons event listeners
  document.getElementById("btn-home").addEventListener("click", () => {
    loadIframePage("home");
  });
  document.getElementById("btn-forum").addEventListener("click", () => {
    showForumPage();
  });
  document.getElementById("btn-informasi").addEventListener("click", () => {
    loadIframePage("informasi");
  });
  document.getElementById("btn-tentang").addEventListener("click", () => {
    loadIframePage("tentang");
  });
  document.getElementById("btn-profil").addEventListener("click", () => {
    spaContainer.classList.add("hidden");
    iframeContainer.classList.add("hidden");
    forumContainer.classList.add("hidden");
    postInputBox.classList.add("hidden");
    // Show profile info in SPA container
    spaContainer.classList.remove("hidden");
    spaContainer.innerHTML = `
      <div class="p-6 max-w-md mx-auto bg-white rounded-lg shadow-md text-center space-y-4">
        <div class="text-5xl font-extrabold text-indigo-600" id="profile-points">${userPointsEl.textContent}</div>
        <div class="text-xl font-semibold" id="profile-name">${userNameEl.textContent}</div>
        <div class="text-gray-600" id="profile-email">${userEmailEl.textContent}</div>
        <div class="flex items-center justify-center space-x-2">
          <div class="text-gray-700 font-mono select-all" id="profile-referral">${userReferralEl.textContent}</div>
          <button id="referral-copy-btn" class="text-indigo-600 hover:text-indigo-800" title="Salin kode referral">
            <i class="fas fa-copy"></i>
          </button>
        </div>
      </div>
    `;
    // Re-attach copy event
    document.getElementById("referral-copy-btn").addEventListener("click", () => {
      const code = document.getElementById("profile-referral").textContent;
      if (code) {
        navigator.clipboard.writeText(code);
        alert("Kode referral disalin ke clipboard");
      }
    });
  });

  // Post input image preview and remove
  postImageInput.addEventListener("change", () => {
    const file = postImageInput.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = e => {
        postImagePreview.src = e.target.result;
        postImagePreview.classList.remove("hidden");
        postImageRemoveBtn.classList.remove("hidden");
      };
      reader.readAsDataURL(file);
    }
  });
  postImageRemoveBtn.addEventListener("click", () => {
    postImageInput.value = "";
    postImagePreview.src = "";
    postImagePreview.classList.add("hidden");
    postImageRemoveBtn.classList.add("hidden");
  });

  // Upload image to Imgur
  async function uploadImageToImgur(file) {
    const clientId = "0f3d0dc555fdb38";
    const formData = new FormData();
    formData.append("image", file);
    const res = await fetch("https://api.imgur.com/3/image", {
      method: "POST",
      headers: {
        Authorization: `Client-ID ${clientId}`
      },
      body: formData
    });
    const data = await res.json();
    if (data.success) {
      return data.data.link;
    } else {
      throw new Error("Upload image to Imgur failed");
    }
  }

  // Submit new post
  postSubmitBtn.addEventListener("click", async () => {
    if (!currentUser) return alert("User belum login");
    const text = postTextInput.value.trim();
    if (!text && !postImageInput.files[0]) {
      return alert("Isi teks atau pilih gambar untuk posting");
    }
    postSubmitBtn.disabled = true;
    postSubmitBtn.textContent = "Posting...";
    try {
      let imageUrl = "";
      if (postImageInput.files[0]) {
        imageUrl = await uploadImageToImgur(postImageInput.files[0]);
      }
      // Save post to Firestore
      await addDoc(collection(db, "posts"), {
        userId: currentUser.uid,
        userName: currentUser.displayName || "User",
        text: text,
        imageUrl: imageUrl,
        likes: [],
        createdAt: serverTimestamp()
      });
      postTextInput.value = "";
      postImageInput.value = "";
      postImagePreview.src = "";
      postImagePreview.classList.add("hidden");
      postImageRemoveBtn.classList.add("hidden");
      alert("Posting berhasil");
    } catch (e) {
      alert("Gagal posting: " + e.message);
    }
    postSubmitBtn.disabled = false;
    postSubmitBtn.textContent = "Post";
  });

  // Load forum posts from Firestore and listen realtime
  function loadForumPosts() {
    if (!currentUser) return;
    const postsCol = collection(db, "posts");
    const q = query(postsCol, orderBy("createdAt", "desc"));
    onSnapshot(q, (snapshot) => {
      const now = new Date();
      forumContainer.innerHTML = "";
      snapshot.docs.forEach(docSnap => {
        const post = docSnap.data();
        const postId = docSnap.id;
        if (!post.createdAt) return;
        const createdAtDate = post.createdAt.toDate();
        // Only show posts less than 24 hours old
        if ((now - createdAtDate) > 24 * 60 * 60 * 1000) {
          // Delete post automatically
          deleteDoc(doc(db, "posts", postId));
          return;
        }
        const {date, time} = formatDateTime(post.createdAt);
        // Create post element
        const postEl = document.createElement("div");
        postEl.className = "bg-white rounded-lg shadow p-4 mb-4";
        postEl.innerHTML = `
          <div class="flex justify-between items-center mb-2">
            <div class="font-semibold text-gray-800">${post.userName}</div>
            <div class="text-xs text-gray-500">${date} ${time}</div>
          </div>
          <div class="mb-2 whitespace-pre-wrap text-gray-700">${escapeHtml(post.text)}</div>
          ${post.imageUrl ? `<img src="${post.imageUrl}" alt="Gambar postingan oleh ${escapeHtml(post.userName)}" class="rounded max-h-64 w-full object-contain mb-2" />` : ""}
          <div class="flex items-center space-x-4 text-gray-600 text-sm">
            <button class="like-btn flex items-center space-x-1" data-postid="${postId}">
              <i class="fas fa-thumbs-up"></i>
              <span class="like-count">${post.likes ? post.likes.length : 0}</span>
            </button>
            <button class="comment-btn flex items-center space-x-1" data-postid="${postId}">
              <i class="fas fa-comment"></i>
              <span>Komentar</span>
            </button>
            <button class="report-btn flex items-center space-x-1 text-red-600" data-postid="${postId}">
              <i class="fas fa-flag"></i>
              <span>Report</span>
            </button>
          </div>
        `;
        forumContainer.appendChild(postEl);
      });
      attachForumButtonsListeners();
    });
  }

  // Escape HTML to prevent XSS
  function escapeHtml(text) {
    if (!text) return "";
    return text.replace(/[&<>"']/g, function(m) {
      return ({
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;'
      })[m];
    });
  }

  // Attach event listeners to forum buttons (like, comment, report)
  function attachForumButtonsListeners() {
    document.querySelectorAll(".like-btn").forEach(btn => {
      btn.onclick = async () => {
        if (!currentUser) return alert("User belum login");
        const postId = btn.getAttribute("data-postid");
        const postRef = doc(db, "posts", postId);
        const postSnap = await getDoc(postRef);
        if (!postSnap.exists()) return;
        const postData = postSnap.data();
        let likes = postData.likes || [];
        if (likes.includes(currentUser.uid)) {
          // Unlike
          likes = likes.filter(uid => uid !== currentUser.uid);
        } else {
          // Like
          likes.push(currentUser.uid);
        }
        await updateDoc(postRef, {likes});
      };
    });
    document.querySelectorAll(".comment-btn").forEach(btn => {
      btn.onclick = () => {
        if (!currentUser) return alert("User belum login");
        currentPostIdForComments = btn.getAttribute("data-postid");
        currentReplyToCommentId = null;
        commentReplyToEl.textContent = "";
        commentReplyToEl.classList.add("hidden");
        commentInputEl.value = "";
        commentModal.classList.remove("hidden");
        loadComments(currentPostIdForComments);
      };
    });
    document.querySelectorAll(".report-btn").forEach(btn => {
      btn.onclick = () => {
        if (!currentUser) return alert("User belum login");
        currentPostIdForReport = btn.getAttribute("data-postid");
        reportReasonSelect.value = "";
        reportModal.classList.remove("hidden");
      };
    });
  }

  // Load comments for a post
  function loadComments(postId) {
    commentListEl.innerHTML = "Loading comments...";
    const commentsCol = collection(db, "posts", postId, "comments");
    const q = query(commentsCol, orderBy("createdAt", "asc"));
    onSnapshot(q, (snapshot) => {
      commentListEl.innerHTML = "";
      if (snapshot.empty) {
        commentListEl.innerHTML = `<div class="text-gray-500 text-center py-4">Belum ada komentar</div>`;
        return;
      }
      // Build comments tree with replies
      const comments = [];
      snapshot.docs.forEach(docSnap => {
        const c = docSnap.data();
        c.id = docSnap.id;
        comments.push(c);
      });
      // Build tree structure
      const commentMap = {};
      comments.forEach(c => commentMap[c.id] = {...c, replies: []});
      const roots = [];
      comments.forEach(c => {
        if (c.replyTo) {
          if (commentMap[c.replyTo]) {
            commentMap[c.replyTo].replies.push(commentMap[c.id]);
          } else {
            roots.push(commentMap[c.id]);
          }
        } else {
          roots.push(commentMap[c.id]);
        }
      });
      // Render comments recursively
      commentListEl.innerHTML = "";
      roots.forEach(c => {
        commentListEl.appendChild(renderComment(c, 0));
      });
    });
  }

  // Render a comment with replies recursively
  function renderComment(comment, level) {
    const div = document.createElement("div");
    div.className = `border-l-2 border-gray-300 pl-3 mb-3 ml-${level * 4}`;
    div.style.marginLeft = `${level * 1.5}rem`;
    div.innerHTML = `
      <div class="text-sm font-semibold text-gray-700">${escapeHtml(comment.userName)}</div>
      <div class="text-xs text-gray-500 mb-1">${comment.createdAt ? formatDateTime(comment.createdAt).date + " " + formatDateTime(comment.createdAt).time : ""}</div>
      <div class="text-gray-800 whitespace-pre-wrap mb-1">${escapeHtml(comment.text)}</div>
      <div class="flex space-x-4 text-xs text-indigo-600 cursor-pointer">
        <div class="comment-reply-btn" data-commentid="${comment.id}">Reply</div>
        <div class="comment-like-btn" data-commentid="${comment.id}">Like (${comment.likes ? comment.likes.length : 0})</div>
      </div>
    `;
    // Replies container
    if (comment.replies && comment.replies.length > 0) {
      comment.replies.forEach(reply => {
        div.appendChild(renderComment(reply, level + 1));
      });
    }
    // Attach reply and like handlers
    setTimeout(() => {
      div.querySelectorAll(".comment-reply-btn").forEach(btn => {
        btn.onclick = () => {
          currentReplyToCommentId = btn.getAttribute("data-commentid");
          commentReplyToEl.textContent = "Replying to comment";
          commentReplyToEl.classList.remove("hidden");
          commentInputEl.focus();
        };
      });
      div.querySelectorAll(".comment-like-btn").forEach(async btn => {
        btn.onclick = async () => {
          if (!currentUser) return alert("User belum login");
          const commentId = btn.getAttribute("data-commentid");
          const commentRef = doc(db, "posts", currentPostIdForComments, "comments", commentId);
          const commentSnap = await getDoc(commentRef);
          if (!commentSnap.exists()) return;
          const commentData = commentSnap.data();
          let likes = commentData.likes || [];
          if (likes.includes(currentUser.uid)) {
            likes = likes.filter(uid => uid !== currentUser.uid);
          } else {
            likes.push(currentUser.uid);
          }
          await updateDoc(commentRef, {likes});
        };
      });
    }, 100);
    return div;
  }

  // Send comment
  commentSendBtn.addEventListener("click", async () => {
    if (!currentUser) return alert("User belum login");
    const text = commentInputEl.value.trim();
    if (!text) return alert("Isi komentar terlebih dahulu");
    const commentsCol = collection(db, "posts", currentPostIdForComments, "comments");
    await addDoc(commentsCol, {
      userId: currentUser.uid,
      userName: currentUser.displayName || "User",
      text: text,
      replyTo: currentReplyToCommentId || null,
      likes: [],
      createdAt: serverTimestamp()
    });
    commentInputEl.value = "";
    currentReplyToCommentId = null;
    commentReplyToEl.textContent = "";
    commentReplyToEl.classList.add("hidden");
  });

  // Cancel reply
  commentReplyCancelBtn.addEventListener("click", () => {
    currentReplyToCommentId = null;
    commentReplyToEl.textContent = "";
    commentReplyToEl.classList.add("hidden");
  });

  // Close comment modal
  commentModalCloseBtn.addEventListener("click", () => {
    commentModal.classList.add("hidden");
  });

  // Report modal close
  reportModalCloseBtn.addEventListener("click", () => {
    reportModal.classList.add("hidden");
  });

  // Send report
  reportSendBtn.addEventListener("click", () => {
    const reason = reportReasonSelect.value;
    if (!reason) return alert("Pilih alasan laporan");
    // Open WhatsApp with prefilled message
    const waNumber = "+628119118047";
    const message = encodeURIComponent(`Laporan untuk postingan ID: ${currentPostIdForReport}\nAlasan: ${reason}`);
    window.open(`https://wa.me/${waNumber.replace(/\D/g, '')}?text=${message}`, "_blank");
    reportModal.classList.add("hidden");
  });

  // Auto delete posts older than 24 hours every 10 minutes
  function startPostCleanupInterval() {
    setInterval(async () => {
      const postsCol = collection(db, "posts");
      const q = query(postsCol, orderBy("createdAt", "asc"));
      const snapshot = await getDocs(q);
      const now = new Date();
      snapshot.docs.forEach(async docSnap => {
        const post = docSnap.data();
        if (!post.createdAt) return;
        const createdAtDate = post.createdAt.toDate();
        if ((now - createdAtDate) > 24 * 60 * 60 * 1000) {
          await deleteDoc(doc(db, "posts", docSnap.id));
        }
      });
    }, 600000);
  }
  </script>
  <!-- Header -->
  <header class="flex justify-between items-center bg-white shadow px-4 py-3 sticky top-0 z-30">
   <div class="flex items-center space-x-3">
    <img alt="Logo GMI Official, a stylized letter G and M in blue and green" class="w-10 h-10 object-contain" height="40" src="https://storage.googleapis.com/a1aa/image/492d45de-4a3e-4e70-5619-629cac43d5f8.jpg" width="40"/>
    <span class="font-semibold text-xl text-indigo-700 select-none">
     gmi official
    </span>
   </div>
   <div class="relative">
    <button aria-label="Open menu" class="text-gray-700 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-full p-2" id="header-menu-btn">
     <i class="fas fa-ellipsis-v fa-lg">
     </i>
    </button>
    <div class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none z-40" id="header-menu-dropdown">
     <ul class="py-1 text-gray-700 text-sm">
      <li>
       <button class="w-full text-left px-4 py-2 hover:bg-indigo-100" onclick="loadSPA('settings')">
        Settings
       </button>
      </li>
      <li>
       <button class="w-full text-left px-4 py-2 hover:bg-indigo-100" onclick="loadSPA('contact')">
        Contact
       </button>
      </li>
      <li>
       <button class="w-full text-left px-4 py-2 hover:bg-indigo-100" onclick="loadSPA('aboutapp')">
        About Apps
       </button>
      </li>
      <li>
       <button class="w-full text-left px-4 py-2 hover:bg-indigo-100" onclick="loadSPA('rateus')">
        Rate Us
       </button>
      </li>
      <li>
       <button class="w-full text-left px-4 py-2 hover:bg-indigo-100" onclick="loadSPA('news')">
        News or Updates
       </button>
      </li>
     </ul>
    </div>
   </div>
  </header>
  <!-- Main content container -->
  <main class="flex-grow flex flex-col">
   <!-- SPA container -->
   <section class="hidden flex-grow overflow-auto bg-gray-50" id="spa-container">
   </section>
   <!-- Iframe container -->
   <section class="hidden flex-grow bg-white" id="iframe-container">
    <iframe class="w-full h-full min-h-[400px]" frameborder="0" src="">
    </iframe>
   </section>
   <!-- Forum container -->
   <section class="hidden flex-grow overflow-auto p-4 max-w-3xl mx-auto" id="forum-container">
    <!-- Posts will be appended here -->
   </section>
   <!-- Post input box -->
   <div class="hidden max-w-3xl mx-auto p-4 bg-white border-t border-gray-300 flex flex-col space-y-3" id="post-input-box">
    <textarea class="resize-none rounded-md border border-gray-300 p-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" id="post-text-input" placeholder="Katakan sesuatu..." rows="3"></textarea>
    <div class="flex items-center space-x-3">
     <label class="cursor-pointer text-indigo-600 hover:text-indigo-800 flex items-center space-x-1" for="post-image-input">
      <i class="fas fa-image">
      </i>
      <span>
       Upload Gambar
      </span>
     </label>
     <input accept="image/*" class="hidden" id="post-image-input" type="file"/>
     <img alt="Preview gambar yang akan diupload" class="hidden max-h-32 rounded-md border border-gray-300" id="post-image-preview" src=""/>
     <button aria-label="Hapus gambar upload" class="hidden text-red-600 hover:text-red-800" id="post-image-remove-btn">
      <i class="fas fa-times-circle fa-lg">
      </i>
     </button>
     <button class="ml-auto bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md font-semibold" id="post-submit-btn">
      Post
     </button>
    </div>
   </div>
  </main>
  <!-- Footer navigation -->
  <footer class="bg-white border-t border-gray-300 fixed bottom-0 left-0 right-0 flex justify-around items-center h-16 shadow-inner z-30">
   <button aria-label="Beranda" class="flex flex-col items-center text-gray-600 hover:text-indigo-700 focus:outline-none" id="btn-home">
    <i class="fas fa-home fa-lg">
    </i>
    <span class="text-xs">
     Beranda
    </span>
   </button>
   <button aria-label="Forum" class="flex flex-col items-center text-gray-600 hover:text-indigo-700 focus:outline-none" id="btn-forum">
    <i class="fas fa-comments fa-lg">
    </i>
    <span class="text-xs">
     Forum
    </span>
   </button>
   <button aria-label="Informasi" class="flex flex-col items-center text-gray-600 hover:text-indigo-700 focus:outline-none" id="btn-informasi">
    <i class="fas fa-info-circle fa-lg">
    </i>
    <span class="text-xs">
     Informasi
    </span>
   </button>
   <button aria-label="Tentang" class="flex flex-col items-center text-gray-600 hover:text-indigo-700 focus:outline-none" id="btn-tentang">
    <i class="fas fa-info fa-lg">
    </i>
    <span class="text-xs">
     Tentang
    </span>
   </button>
   <button aria-label="Profil" class="flex flex-col items-center text-gray-600 hover:text-indigo-700 focus:outline-none" id="btn-profil">
    <i class="fas fa-user fa-lg">
    </i>
    <span class="text-xs">
     Profil
    </span>
   </button>
  </footer>
  <!-- Comment Modal -->
  <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50" id="comment-modal">
   <div class="bg-white rounded-lg max-w-lg w-full max-h-[90vh] flex flex-col">
    <div class="flex justify-between items-center border-b border-gray-300 p-3">
     <h3 class="text-lg font-semibold text-gray-800">
      Komentar
     </h3>
     <button aria-label="Close comments" class="text-gray-600 hover:text-gray-900 focus:outline-none" id="comment-modal-close">
      <i class="fas fa-times fa-lg">
      </i>
     </button>
    </div>
    <div class="overflow-y-auto p-4 flex-grow scrollbar-thin" id="comment-list">
    </div>
    <div class="border-t border-gray-300 p-3 space-y-2">
     <div class="text-indigo-600 text-sm hidden flex items-center justify-between" id="comment-reply-to">
      <span>
      </span>
      <button class="text-red-600 hover:text-red-800 font-semibold text-xs" id="comment-reply-cancel">
       Cancel Reply
      </button>
     </div>
     <textarea class="w-full rounded-md border border-gray-300 p-2 resize-none focus:outline-none focus:ring-2 focus:ring-indigo-500" id="comment-input" placeholder="Tulis komentar..." rows="3"></textarea>
     <button class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded-md font-semibold" id="comment-send-btn">
      Kirim
     </button>
    </div>
   </div>
  </div>
  <!-- Report Modal -->
  <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50" id="report-modal">
   <div class="bg-white rounded-lg max-w-md w-full p-6 space-y-4">
    <h3 class="text-lg font-semibold text-gray-800">
     Laporkan Postingan
    </h3>
    <select aria-label="Pilih alasan laporan" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" id="report-reason">
     <option disabled="" selected="" value="">
      Pilih alasan laporan
     </option>
     <option value="Spam">
      Spam
     </option>
     <option value="Kekerasan verbal">
      Kekerasan verbal
     </option>
     <option value="Konten tidak pantas">
      Konten tidak pantas
     </option>
     <option value="Lainnya">
      Lainnya
     </option>
    </select>
    <div class="flex justify-end space-x-3">
     <button class="px-4 py-2 rounded-md border border-gray-300 hover:bg-gray-100 focus:outline-none" id="report-modal-close">
      Batal
     </button>
     <button class="px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700 focus:outline-none" id="report-send-btn">
      Kirim
     </button>
    </div>
   </div>
  </div>
 </body>
</html>
