<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Admin - Monitoring Affiliate</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body class="p-6 bg-gray-100">
  <h1 class="text-2xl font-bold mb-6">Statistik Affiliate Semua User</h1>
  <div id="dataList" class="space-y-4"></div>

  <script>
    const firebaseConfig = {
      apiKey: "API_KEY_ANDA",
      authDomain: "PROJECT_ID.firebaseapp.com",
      projectId: "PROJECT_ID",
      storageBucket: "PROJECT_ID.appspot.com",
      messagingSenderId: "SENDER_ID",
      appId: "APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function loadAffiliateData() {
      const container = document.getElementById('dataList');
      const userSnapshot = await db.collection('users').where('isAffiliate', '==', true).get();

      for (let userDoc of userSnapshot.docs) {
        const userData = userDoc.data();
        const commissionsSnap = await db.collection('commissions')
          .where('userId', '==', userDoc.id)
          .get();

        let total = 0;
        let clicks = 0;
        commissionsSnap.forEach(c => {
          total += c.data().amount || 0;
          clicks += c.data().clicks || 0;
        });

        const div = document.createElement('div');
        div.className = 'bg-white p-4 shadow rounded';
        div.innerHTML = `
          <p><strong>Nama:</strong> ${userData.nama}</p>
          <p><strong>Email:</strong> ${userData.email}</p>
          <p><strong>Total Klik:</strong> ${clicks}</p>
          <p><strong>Total Komisi:</strong> Rp ${total.toLocaleString('id-ID')}</p>
          <p><strong>Referral Link:</strong> ${location.origin}/informasi.html?ref=${userDoc.id}</p>
        `;
        container.appendChild(div);
      }
    }

    loadAffiliateData();
  </script>
</body>
</html>
