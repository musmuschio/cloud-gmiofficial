<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Forum</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
  />
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      query,
      orderBy,
      getDocs,
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBrhBBX1CIt5JzCh25tPUwqHJjIVIeyef8",
      authDomain: "gmi-official21-74326.firebaseapp.com",
      projectId: "gmi-official21-74326",
      storageBucket: "gmi-official21-74326.appspot.com",
      messagingSenderId: "496607636364",
      appId: "1:496607636364:web:5c0428ccad6952faa544a9",
      measurementId: "G-KJ0X8CY03M",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let userName = "";

    onAuthStateChanged(auth, (user) => {
      if (user) {
        userName = user.displayName || user.email;
        const userNameEl = document.getElementById("user-name");
        if (userNameEl) userNameEl.textContent = userName;
      } else {
        alert("Please log in to view posts.");
        window.location.href = "login.html";
      }
    });

    const loadPosts = async () => {
      const postsRef = collection(db, "posts");
      const q = query(postsRef, orderBy("timestamp", "desc"));
      const querySnapshot = await getDocs(q);

      const postsContainer = document.getElementById("posts-container");
      postsContainer.innerHTML = "";

      querySnapshot.forEach((doc) => {
        const postData = doc.data();
        const postElement = document.createElement("div");
        postElement.classList.add(
          "bg-white",
          "shadow-md",
          "rounded-lg",
          "p-6",
          "mb-6",
          "border",
          "border-gray-200"
        );
        postElement.innerHTML = `
          <h3 class="text-xl font-semibold text-gray-900 mb-2">${postData.name}</h3>
          <p class="text-gray-700 mb-4 whitespace-pre-line">${postData.description}</p>
          <p class="text-sm text-gray-500">Posted on: ${new Date(
            postData.timestamp.seconds * 1000
          ).toLocaleString()}</p>
        `;
        postsContainer.appendChild(postElement);
      });
    };

    window.onload = loadPosts;
  </script>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
  <header class="bg-white shadow p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between">
    <h1 class="text-3xl font-bold text-gray-900 mb-2 sm:mb-0">Forum</h1>
    <div class="flex items-center space-x-4">
      <p class="text-gray-700 text-sm sm:text-base">
        Logged in as: <span id="user-name" class="font-semibold">Loading...</span>
      </p>
      <button
        onclick="window.location.href='update.html'"
        class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
        aria-label="Add New Post"
      >
        <i class="fas fa-plus mr-2"></i> Add New Post
      </button>
    </div>
  </header>

  <main class="flex-grow max-w-3xl mx-auto p-4 w-full">
    <div id="posts-container" class="mt-6"></div>
  </main>

  <footer class="bg-white shadow-inner p-4 text-center text-gray-500 text-sm">
    &copy; 2024 Forum. All rights reserved.
  </footer>
</body>
</html>
