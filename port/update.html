<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Status</title>

    <!-- Firebase SDK CDN -->
    <script type="module">
        // Mengimpor fungsi yang dibutuhkan dari SDK Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        // Konfigurasi Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBrhBBX1CIt5JzCh25tPUwqHJjIVIeyef8",
            authDomain: "gmi-official21-74326.firebaseapp.com",
            projectId: "gmi-official21-74326",
            storageBucket: "gmi-official21-74326.firebasestorage.app",
            messagingSenderId: "496607636364",
            appId: "1:496607636364:web:5c0428ccad6952faa544a9",
            measurementId: "G-KJ0X8CY03M"
        };

        // Inisialisasi Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);
    </script>

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f4f4f4;
        }
        form {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            margin: auto;
        }
        input, textarea, button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        button {
            background-color: #28a745;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>

<h1>Update Status</h1>
<form id="statusForm">
    <input type="text" id="name" placeholder="Nama" required>
    <textarea id="description" placeholder="Deskripsi" required></textarea>
    <input type="file" id="image" accept="image/*">
    <button type="submit">Kirim</button>
</form>

<!-- Scripts -->
<script>
    // Menambahkan event listener untuk menangani pengiriman formulir
    document.getElementById('statusForm').addEventListener('submit', async function (e) {
        e.preventDefault();

        // Ambil nilai input
        const name = document.getElementById('name').value;
        const description = document.getElementById('description').value;
        const image = document.getElementById('image').files[0];

        try {
            // Unggah gambar jika ada
            let imageUrl = null;
            if (image) {
                imageUrl = await uploadImage(image);
            }

            // Simpan data ke Firestore
            const docRef = await addDoc(collection(db, 'statuses'), {
                name: name,
                description: description,
                imageUrl: imageUrl,
                createdAt: serverTimestamp()
            });

            console.log('Dokumen berhasil ditambahkan dengan ID: ', docRef.id);

            // Tampilkan pesan sukses
            alert('Status berhasil diperbarui!');

            // Arahkan pengguna ke forum.html
            window.location.href = 'forum.html';

        } catch (error) {
            console.error('Error menambahkan dokumen: ', error);
            alert('Terjadi kesalahan. Coba lagi!');
        }
    });

    // Fungsi untuk mengunggah gambar ke Firebase Storage
    async function uploadImage(file) {
        const storageRef = ref(storage, 'images/' + file.name);
        await uploadBytes(storageRef, file);
        return await getDownloadURL(storageRef);
    }
</script>

</body>
</html>
