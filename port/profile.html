<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Profil Pengguna</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"></link>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-app.js";
    import {
      getFirestore,
      doc,
      getDoc
    } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-firestore.js";
    import {
      getAuth,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBrhBBX1CIt5JzCh25tPUwqHJjIVIeyef8",
      authDomain: "gmi-official21-74326.firebaseapp.com",
      projectId: "gmi-official21-74326",
      storageBucket: "gmi-official21-74326.appspot.com",
      messagingSenderId: "496607636364",
      appId: "1:496607636364:web:5c0428ccad6952faa544a9",
      measurementId: "G-KJ0X8CY03M"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    window.addEventListener("DOMContentLoaded", () => {
      const usernameEl = document.getElementById("username");
      const emailEl = document.getElementById("email");
      const kodeReferralEl = document.getElementById("kodeReferral");
      const salinBtn = document.getElementById("salinBtn");
      const loadingEl = document.getElementById("loading");

      onAuthStateChanged(auth, async (user) => {
        if (user) {
          const uid = user.uid;
          const userRef = doc(db, "users", uid);
          const docSnap = await getDoc(userRef);

          if (docSnap.exists()) {
            const data = docSnap.data();
            usernameEl.textContent = data.username || "(tanpa nama)";
            emailEl.textContent = data.email || "(tanpa email)";
            kodeReferralEl.textContent = data.kode_referral || "Belum ada kode";

            salinBtn.onclick = () => {
              navigator.clipboard.writeText(data.kode_referral || "").then(() => {
                alert("Kode referral berhasil disalin!");
              });
            };

            loadingEl.style.display = "none";
          } else {
            loadingEl.textContent = "Data pengguna tidak ditemukan.";
          }
        } else {
          loadingEl.textContent = "Belum login.";
        }
      });
    });
  </script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
  <div class="bg-white rounded-xl shadow-md p-6 w-full max-w-md">
    <h1 class="text-2xl font-bold text-center mb-4 text-green-700">Profil Anda</h1>
    
    <div id="loading" class="text-center text-gray-500 mb-4">Memuat profil...</div>

    <div class="space-y-4">
      <div>
        <label for="username" class="font-semibold text-gray-700">Username</label>
        <p id="username" class="bg-gray-100 p-2 rounded mt-1 text-gray-900" tabindex="0" aria-label="Username pengguna">-</p>
      </div>
      <div>
        <label for="email" class="font-semibold text-gray-700">Email</label>
        <p id="email" class="bg-gray-100 p-2 rounded mt-1 text-gray-900" tabindex="0" aria-label="Email pengguna">-</p>
      </div>
      <div>
        <label for="kodeReferral" class="font-semibold text-gray-700">Kode Referral</label>
        <div class="flex items-center mt-1">
          <p id="kodeReferral" class="bg-gray-100 p-2 rounded flex-grow text-gray-900 truncate" tabindex="0" aria-label="Kode referral pengguna">-</p>
          <button id="salinBtn" class="ml-2 px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-1" aria-label="Salin kode referral">
            <i class="fas fa-copy"></i> Salin
          </button>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
