<html lang="id">
 <head>
  <meta charset="utf-8"/>
  <title>
   e-Wallet Pengguna
  </title>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
      font-family: 'Inter', sans-serif;
    }
  </style>
  <script type="module">
   import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBrhBBX1CIt5JzCh25tPUwqHJjIVIeyef8",
      authDomain: "gmi-official21-74326.firebaseapp.com",
      projectId: "gmi-official21-74326",
      storageBucket: "gmi-official21-74326.appspot.com",
      messagingSenderId: "496607636364",
      appId: "1:496607636364:web:5c0428ccad6952faa544a9",
      measurementId: "G-KJ0X8CY03M"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    window.addEventListener("DOMContentLoaded", () => {
      const loadingEl = document.getElementById("loading");
      const walletEl = document.getElementById("wallet");
      const usernameEl = document.getElementById("username");
      const emailEl = document.getElementById("email");
      const kodeReferralEl = document.getElementById("kodeReferral");
      const salinBtn = document.getElementById("salinKode");
      const pointEl = document.getElementById("point");
      const balanceEl = document.getElementById("balance");
      const transactionsEl = document.getElementById("transactions");

      function formatRupiah(number) {
        return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(number);
      }

      function createTransactionItem(tx) {
        const div = document.createElement("div");
        div.className = "flex justify-between items-center py-3 border-b border-gray-200";

        const left = document.createElement("div");
        left.className = "flex items-center space-x-3";

        const icon = document.createElement("i");
        icon.className = tx.type === "in" ? "fas fa-arrow-down text-green-500 text-lg" : "fas fa-arrow-up text-red-500 text-lg";
        left.appendChild(icon);

        const info = document.createElement("div");
        info.className = "text-sm";

        const desc = document.createElement("p");
        desc.className = "font-semibold text-gray-800";
        desc.textContent = tx.description;
        info.appendChild(desc);

        const date = document.createElement("p");
        date.className = "text-gray-500";
        date.textContent = tx.date;
        info.appendChild(date);

        left.appendChild(info);

        const right = document.createElement("div");
        right.className = tx.type === "in" ? "text-green-600 font-semibold" : "text-red-600 font-semibold";
        right.textContent = (tx.type === "in" ? "+ " : "- ") + formatRupiah(tx.amount);

        div.appendChild(left);
        div.appendChild(right);

        return div;
      }

      onAuthStateChanged(auth, async (user) => {
        if (user) {
          const uid = user.uid;
          const userRef = doc(db, "users", uid);
          const docSnap = await getDoc(userRef);

          if (docSnap.exists()) {
            const data = docSnap.data();
            usernameEl.textContent = data.username || "(tanpa nama)";
            emailEl.textContent = data.email || "(tanpa email)";
            kodeReferralEl.textContent = data.kode_referral || "Belum ada kode";
            pointEl.textContent = data.point !== undefined ? data.point : 0;
            balanceEl.textContent = formatRupiah(data.balance !== undefined ? data.balance : 0);

            salinBtn.onclick = () => {
              navigator.clipboard.writeText(data.kode_referral || "").then(() => {
                alert("Kode referral berhasil disalin!");
              });
            };

            // Example transactions data (replace with real data if available)
            const transactions = data.transactions || [
              { id: 1, type: "in", description: "Top Up Saldo", amount: 150000, date: "2024-06-10" },
              { id: 2, type: "out", description: "Pembayaran Listrik", amount: 75000, date: "2024-06-09" },
              { id: 3, type: "in", description: "Cashback Promo", amount: 20000, date: "2024-06-08" },
              { id: 4, type: "out", description: "Pembayaran Internet", amount: 100000, date: "2024-06-07" },
              { id: 5, type: "out", description: "Transfer ke Teman", amount: 50000, date: "2024-06-06" },
              { id: 6, type: "in", description: "Refund Pembayaran", amount: 30000, date: "2024-06-05" },
              { id: 7, type: "out", description: "Pembelian Pulsa", amount: 50000, date: "2024-06-04" },
              { id: 8, type: "in", description: "Top Up Saldo", amount: 100000, date: "2024-06-03" },
              { id: 9, type: "out", description: "Pembayaran Air", amount: 40000, date: "2024-06-02" },
              { id: 10, type: "in", description: "Bonus Referral", amount: 25000, date: "2024-06-01" }
            ];

            transactionsEl.innerHTML = "";
            transactions.forEach(tx => {
              transactionsEl.appendChild(createTransactionItem(tx));
            });

            loadingEl.style.display = "none";
            walletEl.style.display = "block";
          } else {
            loadingEl.textContent = "Data pengguna tidak ditemukan.";
            walletEl.style.display = "none";
          }
        } else {
          loadingEl.textContent = "Belum login.";
          walletEl.style.display = "none";
        }
      });
    });
  </script>
 </head>
 <body class="bg-gradient-to-b from-green-100 to-green-50 min-h-screen flex flex-col items-center p-4">
  <div class="w-full max-w-md bg-white rounded-3xl shadow-lg overflow-hidden">
   <div class="bg-green-600 p-6 flex flex-col space-y-1">
    <h1 class="text-white text-2xl font-semibold leading-tight" id="username" tabindex="0">
     -
    </h1>
    <p class="text-green-200 text-sm truncate max-w-full" id="email" tabindex="0">
     -
    </p>
   </div>
   <div class="p-6 text-center text-gray-600 font-medium" id="loading">
    Memuat data...
   </div>
   <div class="p-6 space-y-6" id="wallet" style="display:none;">
    <div class="flex justify-between items-center">
     <div>
      <p class="text-gray-500 font-semibold">
       Saldo e-Wallet
      </p>
      <p class="text-3xl font-extrabold text-green-700" id="balance" tabindex="0">
       Rp0
      </p>
     </div>
     <div class="bg-green-100 rounded-full px-4 py-2 text-green-700 font-semibold flex items-center space-x-2 select-none">
      <i class="fas fa-coins">
      </i>
      <span id="point" tabindex="0">
       0
      </span>
      <span>
       Points
      </span>
     </div>
    </div>
    <div class="bg-gray-100 rounded-xl p-4">
     <h2 class="text-lg font-semibold text-gray-700 mb-4">
      Riwayat Transaksi
     </h2>
     <div class="max-h-64 overflow-y-auto scrollbar-thin scrollbar-thumb-green-400 scrollbar-track-green-100" id="transactions">
     </div>
    </div>
    <div class="bg-green-50 rounded-xl p-4 flex items-center justify-between">
     <div>
      <p class="text-gray-600 font-semibold">
       Kode Referral Anda
      </p>
      <p class="text-green-700 font-bold text-lg truncate max-w-xs" id="kodeReferral" tabindex="0">
       -
      </p>
     </div>
     <button aria-label="Salin kode referral" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-green-500" id="salinKode">
      <i class="fas fa-copy mr-2">
      </i>
      Salin Kode
     </button>
    </div>
   </div>
  </div>
 </body>
</html>
